# -
在复杂楼层背景下，一种基于深度强化学习的目的楼层预约调度算法的多智能体电梯群控系统的研究
在复杂楼层背景下，一种基于深度强化学习的目的楼层预约调度算法的多智能体电梯群控系统的研究
第一章 绪论 
1.1  研究目的及意义
随着经济和科技的飞速发展，电梯工业也取得了很大的进步，先进的派体策略和控制方式都被应用到电梯群控系统中。当前电梯客流信息管理模式绝大多数还是采用传统的派梯方式，即二次输入模式。乘客在候梯大厅外部按键选择上行或者下行方向，进入电梯厢后再选择目的楼层。这种方式，在进入电梯厢之前，乘客的目的楼层不确定，目的楼层的滞后性和不确定性，对乘客的候梯和候梯时间的影响误差较大，导致派梯的效果和性能欠佳。
伴随着传统电梯群控系统结构的改进，出现了一些新型的电梯控制系统，如双层轿厢电梯的群控系统、多轿厢电梯的控制系统和目的楼层预约呼梯群控系统。目的楼层预约呼梯群控系统将上行/下行按钮和选层按键合二为一，将候梯大厅的上下行按钮省去，取而代之的是可以选择具体楼层的全数字键盘。乘客只需在数字键盘中选择要前往的目的楼层，电梯系统在接收到乘客的请求之后，通过系统的派梯调度算法计算出最优的派梯策略，在候梯大厅的数字键盘显示系统给出的派梯信号，通知乘客到指定电梯处等待，引导乘客合理乘梯。
目前，国内外对目的楼层预约调度算法的研究还处于起步阶段。本文提出了一种基于深度强化学习的目的楼层预约调度算法，为让电梯调度算法在调度时间最短和算法适应性方面具备更好表现，在目前主流的电梯调度算法 基础之上，提出对调度环境和调度目标2个方面进行统一建模的基于强化学习DQN的电梯智能调度算法。让调度电梯在不断地和环境交互学习过程中逐渐学习得到最优电梯调度策略，与基于具体环境建模的相关电梯调度算法进行对比实验，基于DQN的调度算法具有建模简单规范、适应性强和控制目标多样，效率更高的优势，对比 DQN算法与部分强化学习算法 在电梯调度中的优劣，实验结果表明，DQN算法具备较好的调度性能。 

关键词：智能调度；电梯调度算法;强化学习；神经网络;深度强化学习；DQN

1.2本文的主要内容与章节安排
本部分在内容调整完以后最后写出。
.第二章  电梯调度本身要面临的环境
2.1  电梯群控系统概述
1.定义：在建筑设计中，通常将多台电梯以并列或者对列形式配置在一起，构成电梯群，并对其实施群控制，集中为大楼提供服务；也就是将安装在建筑物内的3台或3台以上的一组电梯作为一个有机整体，使用一个自动控制系统调度每一台电梯运行，这就是电梯群控系统(Elevator Group Control System，简称EGCS)。
2.特点：EGCS是一个实时性非常强的系统，需要不断收集电梯群状态信息（当前位置，运行方向，轿厢负荷等）和层站召唤信息，依据一定派梯策略，选择最合适电梯，去应答层站召唤。[19]
3.目的：提高垂直交通系统运行效率，提供较短候梯时间和运行时间为乘客提供服务，提高对乘客服务质量,减少能耗。[19]
4.研究背景：传统群控算法只有一个目标，即最小候梯时间。现代高层建筑一些特定交通模式下，不可能要求每部电梯服务每个楼层，因为这样会使每一部轿厢在其运行过程中停站数量大大增加，使电梯运行周期变长，系统总体性能随之变差。因此电梯群控技术研究具有重要现实意义。[20] 
5.电梯服务过程描述：在随机时间和楼层，乘客随机到达电梯前厅，发出上行或下行层站呼叫，直到乘客进入轿厢按下轿厢呼叫按钮之前，其目的层是不确定的，而调度程序必须以一种基于全局系统优化方式,通过选择轿厢运动方向，对所有指派给它当前方向上的层站呼叫提供服务。[17] [21]
6.电梯群调度问题实质：一个在变化环境下的在线调度、资源配置及随机最优控制的组合优化问题，对该问题复杂性研究表明， 电梯群调度问题属于 NP-hard 问题。电梯指派发生时，重要性能指标是乘客平均候梯时间、系统服务时间和系统响应时间。电梯调度目标是对群控系统时间序列性能指标优化。[22]

2.2  电梯群控系统特性
电梯群控系统特性主要表现为不确定性、信息不完备性、扰动性、多目标性几个方面。[23]群控系统归根结底属于若干电梯之间任务分配及调度问题，复杂程度由系统所运行环境与自身特性所决定。
1.电梯运行过程中包含着许多不确定性，体现在以下几个方面：呼梯信号产生时间和发生层数不确定、各层站候梯人数不确定、乘客目的楼层不确定。
电梯交通系统中乘客需求产生具有随机性，这种随机性主要体现在乘客到达层站时间随机、乘客所在起始层随机、乘客目的层随机等，但同时这些随机性也具有一定约束，例如在上行高峰模式下，乘客起始楼层大多数稳定在大厅层站位置；在上班时间范围，选择某一层作为目的层的人数基本稳定。因此电梯交通系统随机性表现为具有一定规律随机性(可以通过随机图形化解决)。
这些不确定因素对群控系统调度派梯、预测时间等造成直接影响，群控算法目标就是使控制系统在不确定性因素存在情况下，给出最优控制效果。 
2.群控系统不完备性表现在：不能够准确获取当前轿厢中乘客数量；乘客在进入轿厢之前没有输入目标层信息，做出派梯策略所依赖乘客数据信息不完备。 
3.群控系统中扰动可以出现在任意时间，例如：乘客输入错误呼梯请求，需取消错误输入并进行新呼梯请求；乘客在出入轿厢时保持较长时间开门状态，使得该时段内派梯策略不能达到预计服务效果等。
4.群控系统含有若干控制目标，各控制目标之间联系相互交错，所以设计群控系统时需对控制目标进行综合考虑，控制目标表现形式多样化，主要包含以下几个方面：
a.平均候梯时间短。候梯时间是指产生乘梯需求开始，至群控系统指派的轿厢到达该乘客所在位置，响应其服务请求时所耗费时间。相关资料证明，乘客在等候电梯到达时心理焦虑指数与等候时间长短成正比，当等候时间超过一分钟，其心理焦虑度会快速增加。候梯时间平均值是衡量整个电梯群控制性能优劣重要指标，体现群控系统作为整体，对召唤请求服务水平。
b.平均乘梯时间短。乘梯时间是指乘客从起始位置进入轿厢开始，至到达终点位置所消耗时间。乘梯时间长短同样会影响乘客舒适度，乘坐过程中轿厢频繁开关门，可能导致乘坐至顶层乘客较为焦虑，因此乘梯时间也应维持在合理范围之内。
c.维持较高乘客输送能力。输送乘客是电梯群控本职任务，需要对各种不同客流交通情况做出细致分析，在任何情况下均能做出合适派梯策略，使乘客运输能力始终保持在较高水平。例如在上行高峰时段电梯上行至最高层之后，无论是否有呼叫请求，均自动返回底部楼层等候，使得下一批乘客到达时不必经历过长等候时间。(次要目标，高级电梯自然是以结果最快为准，插队算法另计)
d.保持适中轿厢拥挤度。轿厢内过度拥挤同样影响乘客乘梯满意度，而且会加重轿厢负荷，带来更大机械磨损。(次要目标。高级电梯)
e.系统能耗较低。电梯能耗与所采用硬件、机械结构、控制算法等因素有关，如最开始组电动机-发电机能耗很大，且控制方式简陋，效率较低；而现在多采用无齿轮电机，利用 VVVF 变频驱动方式，使得电梯能耗大大降低。控制算法对系统能耗影响也不容小觑，电梯停靠次数控制、速度切换控制等均与系统能耗有直接关联，合理设计群控系统与调度方式是降低电梯能源消耗重要手段。(次要目标。高级电梯)

2.3 电梯群控系统考虑问题与交通模式
交通模式的设计的目的有两个方面，第一个方面是为了在乘客多数是为了上还是下方面设计，第二个方面是通过客流量仿真让电梯停在合适的位置，从而达成节能的目的。
而我的推论则是，无论是哪种，都是效率优先，肯定是时间指数越短越好，因为花的时间越少，浪费的电能也越少，那么，我们在评价指标处就要有所取舍。比如（仅仅是比如）:平均候梯时间、长候梯率、能耗统计值的时候，我们就不会把能耗统计值作为指标的一种。根据总体最优，还是有条件的局部最优的不同[24]，它对应的评价计算指标也应该有所不同。
进一步，考虑到蒙特卡洛搜索树的特性，我将交通模式的定义与奖励函数，行动函数合并，下面的交通模式与特性是传统视角的考虑，这里稍作介绍，供大家了解。
1.电梯群控系统考虑问题[23]
电梯动态特性：额定速度、加速度、运动时间、加载/卸载乘客数量；
评价准则：平均候梯时间、长候梯率、能耗统计值；
评价方法：主要有仿真方法、模糊专家系统方法和神经网络方法；
层站呼叫指派方法(HCAM)：当一个新的层站呼叫发生时，HCAM 需完成3个步骤: 输入当前交通条件、性能预测及确定服务轿厢；
交通量自适应性：用已知的当前交通数据预测层站呼叫的发生情况，估计可能指派而后作出决策；
再指派能力：根据最新系统条件重新作出指派。
2.电梯交通模式(初步看来可以无视，后续电梯的放置可以考虑)
上行高峰交通模式：所有乘客均由建筑物底层（基站）大厅进入轿厢,当电梯把乘客送至各自目的层后,直接返回基站,重复执行运送基站乘客的工作；
午餐交通模式：所有乘客到底层用餐之后返回各自的楼层；
下行高峰交通模式：所有乘客都运行至基站；
层间交通：这种模式主要特点为上行和下行乘客所占比例大致相当，且乘客数量具有随机性，各层之间交通需求基本平衡，此模式情况下不能对乘客服务需求层做出准确预测；
空闲交通：楼层客流稀少，不足以使用全部电梯，而让其余电梯正常服务。
其中上行高峰与下行高峰不是简单顺序倒置，下行高峰有多个到达 (起始) 楼层，而只有一个目的层；上行高峰仅有一个到达楼层而有多个目的楼层，这种区分意义在于准确估计乘客平均候梯时间。交通模式识别是电梯群控系统一项重要内容，是调度策略优化必要前提。
3.其他定义
上行交通模式：当主要交通流是上行方向，即大部分乘客呼梯楼层在建筑物基层，目的楼层为以上各层的情况，被定义为上行交通模式；
下行交通模式：当主要交通流是下行方向，即大部分乘客是从各个楼层乘梯下行到基层离开建筑物，这种情况被称为下行交通模式；
层间交通模式：当上行和下行乘客数量大致相同，这种情况定义为层间交通模式。
层间交通模式分为以下几种情况：
a.当主要交通流朝着除基层之外某一层而来或从该层去往其他楼层，称为两路交通模式；
b.当主要交通流是朝着某两层而来或由某两层去往其他各楼层，称为四路交通模式；
c.当上行和下行乘客数量大致相同|起始楼层和目标楼层比较分散，称为随机层间交通模式；
d.空闲交通模式：当大楼交通流稀少，这种情况被称为随机交通模式。

2.4  本次环境的两个设计理念
朗曼在2017年发出的论文中[17]，出于电梯的启动与停止会造成大量的能量消耗，从而将电梯的节能指标作为单独评价指标，并以此引出了电梯决策中的停层决策。而本论文中考虑到本次应用电梯的特性是效率优先，且花费的时间越少，浪费的电能越少这一思路，将总候梯时间（包括乘梯时间和候梯时间）、电梯的节能指标一起作为电梯调度算法的评价指标。这样做使得对算法的评价更加地全面，更能体现算法的优势。
考虑到本次应用电梯的特性(效率优先)以及花的时间越少，浪费的电能也越少这一思路，在下面的指标中我将停靠与待服务合并设定为无方向，在决策函数中将决策简化为上与下，剩下交给计算机去判断。这样做的优势在于让计算机根据算法，计算出出花费时间最少的电梯运行方案，从而达到电梯调度最优的结果，减少乘客候梯时间，减少电能的浪费。
2.5 楼层环境
参考XX文献的描述，与我们复杂楼层的电梯调度环境的结合，我们提出以下的楼层环境
1.向上需求，即对行动函数进行设置，或者增大变换电梯运送时间的惩罚值
2.向下需求，即对行动函数进行设置，或者增大变换电梯运送时间的惩罚值
3.禁停楼层，我们认为，在使用场景不固定的情况下，这是次要参数，我们暂不考虑。若有考虑的需求，可以通过设置惩罚点解决
2.6  电梯状态
电梯状态有上行、下行与静止，其中静止为无方向（也有文献将上行、下行、停靠、待服务设为电梯状态），考虑到目前的计算方式是先停止电梯的服务，因此我们将停靠与待服务状态合并设定为静止状态（即无方向）。
2.7  电梯环境
参考XX文献和XX文献，我们提出以下环境参数的考量
当前楼层
门开比例，这是计算机的自主决策问题，可以交给DQN自行判断
箱内按键楼层，我们是预约制电梯，这个参数予以忽视
最高楼层
调度楼层，这是计算机的自主决策问题，可以交给DQN自行判断
是否超载
当前速度
调度方向
电梯门正在打开
最大速度
承载重量
电梯门正在关闭
运行方向
最大载重预约制电梯
2.8  评价指标的设计理念与参考
算法是人写的，推导的思路由人决定，但算法反应的结果不一定是符合人逻辑推演的结果。即，在限定条件下的最优方案有不符合人的逻辑的可能，对于人的逻辑有多大的容忍则是算法的适应性问题。
有文献[18]把电梯到目标点的距离值作为一种计算时间长短的媒介。这里我打算单纯地从计算几种方案的最短时间考虑，并在行动函数中设定只能单一方向解决，还有一个思路就是通过设立惩罚点，一定的惩罚系数内允许电梯的上行与下行(比如只间隔一个楼层时)，这就是目标的设定问题，究竟是总体效率最优还是说为了满足人的需求，做一定的妥协，进一步可以思考到电梯的权限。比如，判断为VIP的电梯不接受这样的干涉，判断为总经理的电梯允许一层楼的干涉。 同时也可通过对场景的限定使得算法有一个较好的实验优势。
以下的参数有我们的目标决定，总体等待时间最短，还是有条件的等待时间最短，还是遵循人类的思维，对单一方向是否坚持。
表1 调度算法的调用时刻及决策目标
算法名称	单梯所处状态	调用时刻	决策目标
停层决策	上行或下行	电梯经过楼层前的标志位置	电梯对即将经过的楼层是否停靠

方向决策
	停靠：前决策
	电梯楼层停靠开门前
	这次开门所应服务的请求及关门后的优先方向

运行决策	停靠：关着门	电梯楼层停靠关门后	电梯停靠结束后将转入的状态

表2 评价模式
早高峰模式	午间模式	层间空闲模式	晚高峰模式

表3 电梯评价指标参考
属性
楼层数
层高
运行时长
总步数
客流量


2.9  决策函数(参考)
电梯调度算法包含三个决策算法——停层决策算法、方向决策算法和运行决策算法。单梯智能体在不同的决策时刻调用不同的决策算法来确定本梯是否把前方最近楼层的呼梯信号拉给自己响应。这三个决策算法的调用时刻和决策目标， 在新方案中，我们将决策简化为上与下，剩下交给调度算法去判断。
如表 
表4 调度算法的调用时刻及决策目标
算法名称	单梯所处状态	调用时刻	决策目标
停层决策	上行或下行	电梯经过楼层前的标志位置	电梯对即将经过的楼层是否停靠

方向决策
	停靠：前决策
	电梯楼层停靠开门前
	这次开门所应服务的请求及关门后的优先方向

运行决策	停靠：关着门	电梯楼层停靠关门后	电梯停靠结束后将转入的状态

2.10  评价指标的参考
城镇化水平的提升，各种高层建筑的出现，使人类在垂直方向的出行对电梯存在着高度的依赖性。即满足人类舒适出行的需求，又可以减少其电能的损耗是近年来研究的热门问题。当一组呼梯序列产生时，每一种派梯方案所对应的评价都是不同样的。因此我们所完成的任务就是在这么多的派梯选择中如何能快速找到那个令我们最满意的评价是我们研究所关心的，于是我们通常选取如下几个关键性的性能指标进行研究分析。
1.平均候梯时间（Average Waiting Time，AWT）
候梯时间是指乘客在门厅按下向上或向下的呼梯按钮产生呼梯请求，电梯响应该呼梯需求运行至该层所花费的时间。
AWT 是指在选取的研究样本时间内，所有乘梯人等候乘梯花费的时间与乘客人数做比所得到的值即为 AWT，其值是反应电梯群控性能的关键指标。
2.平均乘梯时间（Average Riding Time，ART）
乘梯时间是指候梯者进入轿厢按下相应按钮产生乘梯需求到乘梯驶往相对应的目的地层的这段时间。根据相关数据表明，乘客在轿厢内的时间越长，其心理满意程度越低。因此，在决策时应当将乘梯时间控制在合理区间之内，通常取最大乘梯时间为90s,ART的求取AWT的求取方法类似。
3.长时间候梯率
等候电梯的乘客中，乘客等候时间超出一定值的乘客占总等候乘客的比率。根据相关统计表明：乘客等候电梯的时间越长，其心理的烦躁程度越强。如果乘客等候时间超出一定程度后，心理的烦躁程度急剧上升。因此，应当将乘客的候梯时间控制在乘客能容忍的范围内。
4.电梯的平均停靠次数（Average Number Of Elevator Stops，ANS）
电梯的平均能耗与平均停靠次数相一致。电梯的平均停靠次数越多，电梯的能耗也就越高。电梯在运行过程中的能耗主要包括以下几部分：乘梯的启动，停止部分、加速运行部分、匀速运行部分，以及电梯运行中一些辅助的设备的用电产生的能耗。经相关数据测算，电梯的启停部分的能耗是往往三者中最高的。因此，尽量减少电梯的启停可以有效削减乘梯的能耗，同时也会大幅降低乘客的平均候梯时间与平均乘梯时间。没有群控系统的电梯运行中，电梯的“空跑”现象非常多，造成了很大的电能浪费，同时运行也加大了电梯的内部磨损，降低了电梯的使用寿命。因此，作为楼宇的管理者，也急切希望在保障电梯运力情况下，能尽可能的降低电梯能耗，进而达到降低维护成本的效果。
第三章 一般方案（国内外研究现状）/电梯群控系统的常见算法
3.1  一般方案的原理
3.1.1  机器学习概述
机器学习是一门多学科交叉专业，涵盖概率论知识，统计学知识，近似理论知识和复杂算法知识，使用计算机作为工具并致力于真实实时的模拟人类学习方式，并将现有内容进行知识结构划分来有效提高学习效率。
随机并行梯度下降算法，简称SPGD算法。作为一种无模型优化算法，比较适用于控制变量较多，受控系统比较复杂，无法建立准确数学模型的最优化控制过程。SPGD控制算法原理主要发展于随机逼近（SA）理论和人工神经网络技术，美国陆军研究实验室的Voronstov在同时扰动随机近似控制算法基础上开发的自适应光学校正技术。
损失函数或代价函数是将随机事件或其有关随机变量的取值映射为非负实数以表示该随机事件的“风险”或“损失”的函数。在应用中，损失函数通常作为学习准则与优化问题相联系，即通过最小化损失函数求解和评估模型。例如在统计学和机器学习中被用于模型的参数估计，在宏观经济学中被用于风险管理和决策，在控制理论中被应用于最优控制理论。
LSTM是一种时间循环神经网络，专门用于解决一般RNN（循环神经网络）的长期依赖问题。所有RNN都具有重复神经网络模块的链式形式。在标准的RNN中，这个重复结构模块只有一个非常简单的结构，比如一个双曲正切函数（tanh）层。
3.1.2  BP神经网络
在多层网络下，利用梯度下降法效率较低，误差逆传播算法能够很好解决这个问题。逆误差传播算法从最后一步的输出开始，基本思想是：计算当前参数下总体误差水平，再对其中各权重参数求偏导（表示各参数对整体误差产生了多少影响），以求出的偏导值*学习率对该权重参数进行更新，不断重复这个过程，直至误差处于我们能够接受的水平。步骤如下：

图2-1 BP神经网络运算流程
计算出当前参数下的总误差——对前一步权重求导——更新权重——重复上面的过程直到满足终止条件。
反向传播问题：
原理：将公式的最外一层层往里剥开，使用偏微分方程求偏导→获取变化率时链式法则的应用
链式法则是微积分中的求导法则，用于复合函数求导。复合函数的导数将为构成复合这有限个函数在相应点的导数的乘积，称链式法则
链式法则公式：
3.1.3  传统电梯群控制算法研究现状
电梯调度方式已经从传统的继电接触控制阶段、集成电路控制阶段发展到今天的智能化控制阶段。对比与德国、美国和日本等发达国家，我国对电梯控制算法研究起步较晚，与国外研究的控制算法相比仍然存在一定差距。总体来说电梯群控制算法在国内外的研究主要包括以下方面：
（1）基于专家系统的电梯群控制算法
专家系统即为使用人类专家推理的计算机模型来处理现实世界中需要专家作出解释的复杂问题。上世纪60年代以来，随着各种控制方法的提出和研究，越来越多优秀控制方法被用于生产实践中来，电梯群控专家系统就是那时开始兴起的一种人工智能应用领域中的新兴算法。电梯群控专家系统组成主要包括数据库，推理机，知识库，解释部分以及知识获取部分。专家系统工作的一些情况，检测得到的一些数据都被存放在数据库中；专家思维和知识形成控制规则存放在数据库中；电梯专家系统知识和经验通过知识获取部分获得。
	虽然S.Tsuji等[6]在1989年的研究中就建立了专家知识库，使用专家经验来实现派梯的合理方案。但专家系统还有一些不足有待解决，电梯系统是个复杂非线性系统，但专家系统知识和经验存在着局限性，控制规则也存在一些缺陷，对于楼层不高建筑或内部结构较简单楼层是没影响的，但如果控制对象是一个高层或者比较复杂的综合大楼，专家设想不可能与实际建筑物吻合，这时单纯采用专家控制方法就不能很好应用在建筑物中，控制效果需进一步完善。
	专家系统因为是人的思维本身就存在着相当的缺陷，这一缺陷在自然语言处理领域已经被证实，所以，在实验设计的时候，应将其列为次要的比较对象 
（2）基于模糊控制的电梯群控制算法
模糊控制近年来在自动控制领域也取得很大进展与突破，并且已经有一套成熟理论知识，在实际应用中，效果也非常明显，特别是模糊控制综合专家系统特点，从中提取经验，对于一些非线性，大复杂性控制对象能表现出很好控制效果。 电梯系统本身是一个非线性，大复杂性系统，电梯运行过程中有着很多不确定因素，因此电梯系统运行状态很难准确预测，此时引入模糊控制就可以很好解决这些难题。模糊数学隶属函数可将复杂模糊问题转化为简单清晰形式求解，这样就可以保证对每个派梯方案都有一个综合而又全面评价。  
Minoru Kaneko等[7]使用模糊控制和专家系统相结合的方法，利用专家系统的先验知识建立模糊理论，从而实现优化调度。上世纪80年代，富士通公式曾研发出FLES-8800系统就带有模糊控制器技术，并将模糊控制理论和专家系统理论相结合，对该电梯系统运行情况和状态利用多种评价指标来完成各种任务多级决策。运用这种控制方法，可以使乘客平均候梯时间减少20%左右，超过一分钟长时间候梯率（LWP）也减少60%左右，轿厢预报准确率提高70%左右。
	但在实际工程中，模糊控制也有不足之处，要想使预先输入控制规则达到预想效果，专家想象建筑物结构必须要跟实际建筑物差别不大，这点很难达到；还有采用模糊控制方法需要大量仿真实验才能调整，确定隶属度函数，这样会使运算量加大，耗费大量时间精力。
（3）基于遗传算法的电梯群控制算法
上世纪90年代初曾研制出一种基于遗传算法FI-3400系列电梯群控算法，遗传算法是一种自适应概率性搜索和优化算法，它来源于抽象生物进化过程，该算法可以智能根据交通流变化而变化，在线实时调整控制参数，并且可以在多个呼梯信号情况下搜索到最优派梯方案，这样可以达到多目标最优调度，即保证系统稳定性和及时性，又达到最大节能效果。遗传算法在解空间上采用多点方式并行搜索，这样可以获得全局最优解，还避免陷入局部极小解点。Atsuya Fujino等[8]使用遗传算法根据预测的呼叫电梯服务需求分布等数据来调整调度控制系统的参数。但遗传算法也有不足之处，其搜索速度比其他控制方法速度偏低，因为遗传算法本身具有随机性和概率性，还有就是要获得最优搜索结果，搜索时间肯定会进一步增长。
（4）基于人工神经网络的电梯群控制算法
人工神经网络（Artificial  Neural  Network，ANN）依据和模仿人大脑工作方式建模，网络结构由人工神经元（即信息处理单元），根据有规律网络结构彼此连接组成。人工神经网络是一种能够进行复杂计算的人工智能数学模型。郭方欣[9]提出了一种用粒子群算法对神经网络权重初始化的电梯群控制优化算法。
（5）基于模糊神经网络电梯群控制算法
模糊神经网络是模糊控制和神往网络结合，实际上就是利用神经网络来控制模糊系统，然后通过一系列训练来获得其中参数，这样就不用依赖专家事先确定。电梯群控系统由于受到外界干扰等不确定因素影响，要想直接对系统建模是不可能的，但是神经网络学习器可以存储并放下各层站所有交通工具，并优化控制变量，然后在模糊控制器自适应性上得到提高，这样可以很好解决待机时长等缺点，并且相比一般控制方法至少可以节能20%以上，可见模糊神经网络控制方法也有很好发展前途。
模糊神经网络不足之处主要是收敛性要依赖于初始条件，还有就是神经网络学习基本上是从专家知识作为出发点，一旦专家知识缺点没有得到应有完善，BP算法也不能得到良好运行。
（6）基于强化学习的电梯群控制算法
强化学习（deep reinforcement learning）作为人工智能领域的热门研究方向，在传统电梯群控制算法中也被广泛研究和运用。顾玲丽等[9]提出了基于强化蚁群的高层住宅电梯群调度算法。普通蚁群算法应用在电梯群调度中，仍会出现迭代次数多、收敛速度慢等问题，将强化学习和蚁群算法相结合，使用Q-learing迭代寻优后的Q值初始化蚁群算法的信息素，通过并行蚁群算法寻找最优派梯策略。王丽冰等[10]提出了基于深度强化学习的电梯调度算法。在电梯调度问题上，将大厦和电梯看作环境，将电梯智能控制终端看作智能体，智能体通过观测电梯运行和呼梯状态决定派梯行为，并根据奖励函数调整派梯策略使累计回报函数最大，从而找到最优派梯策略。刘宇等[12]将强化学习A3C算法应用在电梯调度中，对调度环境、电梯行为和调度目标3个方面进行统一建模，让调度电梯在不断地和环境交互学习中逐渐学习得到最优调度策略。

我国从1986年开始对电梯群控系统进行研究，相对国外讲，起步较晚且技术较落后，在90年代以后对电梯群控系统动态特性进行研究，发表相关论文大多属于概括性原理内容。近年来，国内对电梯群控系统控制技术研究取得很大发展。国内各大公司都竞相从国外引进先进技术和产品，并致力研究自己产品。具有代表有：上海电梯有限公司在94年研发出电梯群控系统能够有效减少候梯时间，并具有设置服务楼层功能；1996年迅达电梯公司研发出电梯群控系统具有可以改变电梯运行参数特点。虽然我国对电梯群控系统研究同国外存在着一些差距，但随着我国电梯群控系统研究范围不断扩大，研究层次不断加深，通过我国各大高校以及研究机构研究学者们不断深入研究，一定会获得较大理论成果。

3.1.4  深度强化学习算法研究现状
近年来，随着深度学习的兴起，深度学习和强化学习的结合研究也受到了更多关注。深度强化学习（Deep Reinforcement Learning）结合了深度学习的结构和强化学习的思想，但侧重点在强化学习上。由强化学习定义优化的目标，深度学习给出表征问题的方式以及解决问题的方式。深度强化学习集成了深度学习在感知问题上的理解能力，以及强化学习的决策能力，实现了端到端的学习，是一种更接近人类思维的人工智能方法。
Google的DeepMind团队研究基于值函数的深度强化学习算法，最具有代表性的算法是由团队中Mnih等[1]人提出的深度Q网络（Deep Q Network）。它使用深度神经网络来代替Q-table，能够适用状态空间和动作空间复杂的场景，将当前状态值作为神经网络的输入，输出端输出所要采取的动作，并采用Q-learing的方式神经网络的参数进行更新，利用经验回放机制减小数据之间的相关性，缩短训练时间。
OpenAI团队研究基于策略的深度强化学习算法，其发表的主要算法包括PPO（Proximal Policy Optimization）[2]，A3C(Asynchronous Advantage Actor-Critic）[3]。
在基于值函数和基于策略的深度强化学习思想的碰撞下，提出了DDPG(Deep Deterministic Policy Gradient)[4]，TD3(Twin Delayed DDPG)[5]等优秀算法。


3.2  一般方案的思路
3.2.1 专家控制系统简介
专家系统是专家知识和经验积累，利用已知知识和经验进行推理分析和判断决策。它由专家经验知识库，推理分析部分，解释部分，知识获取部分组成。通过系统产生若干控制规则，存入知识库中。专家系统用于解决那些不能完全用数学来进行精确描述，表达和计算而要模仿人经验进行处理的问题。系统首先根据已知数据信息，利用知识库专家经验知识，按一定推理规则来实现电梯调度。但对于越来越庞大的电梯群来说，专家系统也有缺点：专家系统更适用于一些电梯数量少，楼层较低建筑物；专家经验要与建筑物电梯群实际情况相对接近，才能获得较好控制效果。
专家控制系统（Expert Control System,ECS）又名基于知识的系统（Knowledge-based System）。专家控制系统作为一个人工智能和控制理论交叉学科，即是人工智能领域专家系统（ES）一个典型应用，也是智能控制理论一个分支。专家控制既可包括高层控制（决策与规划），又可涉及低层控制（动作与实现）。专家控制系统基本结构见图2-2 专家控制系统基本结构。
图2-2 专家控制系统基本结构
与专家系统相似，整个控制问题领域知识库和一个体现知识决策的推理机构成专家控制系统主体。
关键因素：知识库内部组织结构可采用人工智能中知识表示的合适方法。一部分知识可称为数据，例如先验知识、动态信息、由事实及证据推得中间状态和性能目标等。数据常常用一种框架结构组织在一起，形成数据库。另一部分知识可称为规则，即定性推理知识，每条规则都代表着与受控系统有关经验知识，它们往往以产生式规则（if……then……）表示，所有规则组成规则库。在专家控制系统中，定量知识，即各种有关解析算法，一般都独立编码，按常规程序设计方法组织。
推理机基本功能在于按某种控制策略，针对当前问题信息，识别和选取知识库中对解决当前问题有用知识进行推理，直至最终得出问题推理结果。
3.2.2 遗传算法简介
基于遗传算法灵感来源于生物学进化理论，通过模拟生物进化，仿真其基因选择和遗传规则，据此研究而来适用于对概率性事件描述和优化算法。遗传算法属于并行多点式结构，这种结构能得到最优全局解，可避免产生局部极小值，因此遗传算法受限较少，只需要调整目标函数，不需要依赖专家经验就能处理基于多个目标楼层的优化群控算法。
遗传算法（ Genetic Algorithm,GA）主要包含四个步骤：选择，交叉，变异，终止条件。
(1)选择
从群体中选择优胜个体，淘汰劣质个体的操作叫选择。选择算子有时又称为再生算子(reproduction operator)。选择的目的是把优化个体(或解)直接遗传到下一代，或通过配对交叉产生新个体，再遗传到下一代。选择操作是建立在群体中个体适应度评估基础上，目前常用选择算子有以下几种：适应度比例法、随机遍历抽样法、局部选择法。其中轮盘赌选择法 （roulette  wheel  selection）是最简单也是最常用选择方法，在该方法中，各个体选择概率和其适应度值成比例。设群体大小为N，其中个体i适应度为fi，则i被选择概率为Pi，	计算公式为：
显然，概率反映了个体i适应度在整个群体个体适应度总和中所占比例。个体适应度越大，其被选择概率就越高，反之亦然。计算出群体中各个个体选择概率后，为了选择交配个体，需要进行多轮选择。每一轮产生一个[0，1]之间均匀随机数，将该随机数作为选择指针，来确定被选个体。个体被选后，可随机地组成交配对，以供后面交叉操作。
(2)交叉
在自然界生物进化过程中起核心作用的是生物遗传基因重组(加上变异)。同样，遗传算法中起核心作用的是遗传操作交叉算子。所谓交叉，是指把两个父代个体部分结构加以替换重组，而生成新个体的操作。通过交叉，遗传算法搜索能力得以飞跃提高。
交叉算子根据交叉率，将种群中两个体随机交换某些基因，产生新基因组合，期望将有益基因组合在一起。
(3)变异
变异算子基本内容是：对群体中个体串某些基因座上基因值作变动，依据个体编码表示方法不同，可以有以下算法：
①　实值变异
②　二进制变异
一般来说，变异算子操作基本步骤如下：
①　对群体中所有个体，以事先设定变异概率判断是否进行变异；
②　对进行变异个体，随机选择变异位进行变异。
遗传算法引入变异目的有两个:
①　局部随机搜索能力。当遗传算法通过交叉算子已接近最优解邻域时，利用变异算子这种局部随机搜索能力，可以加速向最优解收敛。显然此种情况下，变异概率应取较小值，否则接近最优解积木块会因变异而遭到破坏。
②　可维持群体多样性，以防止出现未成熟收敛现象，此时收敛概率应取较大值。
遗传算法中，交叉算子因其全局搜索能力，而作为主要算子；变异算子因其局部搜索能力，而作为辅助算子。遗传算法通过交叉和变异这对相互配合又相互竞争操作，使其具备兼顾全局和局部的均衡搜索能力。所谓相互配合，是指当群体在进化中陷于搜索空间中某个超平面，而仅靠交叉不能摆脱时，通过变异操作，有助于这种摆脱。所谓相互竞争，是指当通过交叉已形成所期望积木块时，变异操作有可能破坏这些积木块。如何有效配合使用交叉和变异操作，是目前遗传算法一个重要研究内容。
基本变异算子是指，对群体中个体码串随机挑选一个或多个基因座，并对这些基因座基因值做变动(以变异概率P做变动)，(0,1)二值码串中基本变异操作如下：基因位下方标有*号基因发生变异；变异率选取一般受种群大小、染色体长度等因素影响，通常选取很小的值，一般取0.001－0.1。
(4)终止
当最优个体适应度达到给定阈值，或者最优个体适应度和群体适应度不再上升，或者迭代次数达到预设代数，算法终止，预设代数一般设置为100-500代。
具体情况见图2-3 遗传算法基本流程图。

图2-3 遗传算法基本流程图
3.2.3 模糊控制简介
模糊控制是一种将模糊理论应用到控制系统中的智能算法，美国L.A.ZADEH教授最先创立模糊逻辑理论。由于电梯系统中具有不确定性和实时变化特征，所以很难精确预测电梯群交通状态。模糊控制与传统方法相比，优点是不仅能够处理硬件系统传递过来的精确信息，还能够处理一些模糊信号和随机不确定信号。模糊逻辑控制缺点显露在自我学习能力差，无法及时跟踪交通模式复杂变化。模糊控制算法具体情况参见图2-4 模糊控制算法示意图。

图2-4 模糊控制算法示意图
模糊控制器中，输入模糊化，模糊推理，去模糊化是实施模糊控制三个主要环节；有时根据这三个环节作用，分别称为：模糊器，模糊推理机，解模糊器。
3.2.4 人工神经网络简介
人工神经网络（Artificial  Neural  Network,简称ANN）依据和模仿人大脑工作方式建模，网络结构由人工神经元（即信息处理单元），根据有规律网络结构彼此连接组成。人工神经网络是一种能够进行复杂计算的人工智能数学模型。人工神经网络这种智能算法，除了具有并行计算能力，同时还能进行自组织学习，容错能力强也是其优点之一。人工神经网络需要事先进行多次反复训练学习，系统特性决定其无法有效对专家经验和已知知识库进行描述表达和利用。因此在网络学习训练时，通常先将初始权值赋值为零或随机数，然后在不断学习和训练过程中进行自我调整。虽然能够进行误差反馈训练，但如此一来增加了网络训练时间，并且有可能陷入局部极值，导致训练无法达到预期效果，因此人工神经网络并不适合表达基于规则知识。
人工神经网络模型主要考虑网络连接拓扑结构、神经元特征、学习规则等。目前，已有近40种神经网络模型，其中有反传网络、感知器、自组织映射、Hopfield网络、波耳兹曼机、适应谐振理论等。大致结构见图2-5 基本神经网路示意图。

图2-5 基本神经网路示意图
3.2.5 模糊神经网络技术简介
模糊神经网络是吸取了模糊逻辑和人工神经网络优点，并将两者结合的智能信息处理和控制技术。模糊神经网络首先把已知专家经验和知识进行数学表达，然后用模糊逻辑方法确定模糊规则，再通过神经元计算把模糊规则和推理进行变换，通过神经元之间映射关系，从样本库数据中提取出经验规则，最后将其进行智能化处理和输出。模糊神经网络将模糊逻辑方法和人工神经网络方法优点提取并结合起来，模糊信息由人工神经网络技术来处理计算，充分利用其自组织学习能力。模糊逻辑可以发挥其模糊规则和推理优势，有效发挥专家经验和利用已知数据库，取长补短，这就是模糊神经网络。模糊神经网络与传统神经网络主要区别在于：人工神经网络结构和各神经元是纯粹数学计算关系，而模糊神经网络拓扑结构和神经元权值都具有一定逻辑信息。在构建模糊神经网络模型时，可以根据专家经验和已知知识，并结合问题复杂度和精度，来设定合适网络结构。大体模型参照图2-6 模糊神经网络结构图
图2-6 模糊神经网络结构图
①　第一层为输入层，缓存输入信号；
②　第二层为模糊化层，对输入信号进行模糊化；
③　第三层为模糊规则层；
④　第四层为模糊决策层，主要针对满足一定条件的量进行分类，并将模糊量去模糊化；
⑤　第五层为输出层，输出运算结果。 
事实上由于需要不同，要求建立模糊神经网络模型也不同，有的主要要求精度高，而有的主要要求模型尽可能简单。典型模糊神经网络有BP模糊神经网络、自适应神经模糊推理系统 (ANFIS)、B样条模糊神经网络、RBF模糊神经网络、模糊小脑模型神经网络 (FCMAC)、随机模糊神经网络(SFNN)、小波模糊神经网络。模糊神经网络有如下三种形式：
①　逻辑模糊神经网络
②　算术模糊神经网络
③　混合模糊神经网络
模糊神经网络就是具有模糊权系数或者输入信号是模糊量的神经网络。上面三种形式模糊神经网络所执行运算方法不同。
模糊神经网络无论作为逼近器还是模式存储器，都需要学习和优化权系数，学习算法是模糊神经网络优化权系数关键。对于逻辑模糊神经网络，可采用基于误差学习算法，即监视学习算法；对于算术模糊神经网络，则有模糊BP算法，遗传算法等；对于混合模糊神经网络，目前尚未有合理算法；不过混合模糊神经网络一般用于计算而不用于学习，不一定需要学习。
模糊逻辑（Fuzzy Logic）是用隶属度代替布尔真值逻辑，区别于经典二值逻辑。所有命题并不采用绝对二值表达，而是采用隶属度来更灵活表达，这种表达方式用来描述实际生活中模糊概念更加具有普适性。
模糊理论初意是用隶属度表示方法，来替代消除二值之间非此即彼对立，这样才能有效表述不精确概念，使其切合人类思维习惯。模糊理论快速发展，使得模糊推理与模糊决策开始应用到计算机。在二值逻辑运算中，一个命题用“1”代表真，“0”代表假，不是真就是假。隶属度则是对命题模糊概念表示，例如用隶属度值表示命题真的程度，取值区间为[0,1]；隶属度值越大表示真的接近程度越高，值越小表示真的接近程度越低，使表述更加准确。
①　经典集合理论：
域内任何一个元素与集合A映射关系可用如下函数表示：；
②　模糊集合理论：
给定一个域U，U到[0,1]闭区间内任一映射 :U→[0,1] 都确定U中一个模糊集合A，其中称为模糊集合A隶属函数，表示该元素属于该模糊集合程度。如果模糊集合A中元素为x，那么取值范围为闭区间[0,1]；若值越接近1，表示x属于A程度越高；相反越接近0，表示x属于A程度越低。可见模糊集合完全由隶属函数所描述。
隶属函数：定量描述模糊概念，正确选择隶属函数是利用模糊理论解决实际问题前提。由于个体对同一模糊概念理解不同，所以确定隶属函数过程有一定主观性。对群控系统智能调度设计，会大量使用模糊逻辑隶属函数概念。隶属度函数确定没有明确方法，常见方法有:
①　模糊统计法:
对域U上元素x是否属于可变动清晰集合A*进行明确判断，不同测试人员清晰集合会有不一样界限，但它们肯定都对应模糊集A。模糊统计法计算步骤是在每次统计时，元素x不变，A*值可变，经过n次测试，隶属函数计算公式如下：；
②　专家经验法：
以专家实际经验为基础，给出隶属函数确定方法。一般情况，首先根据问题性质，经过分析推理，初步选用某些典型函数作为隶属函数，然后通过不断学习完善；实际运行效果是不断调整和检验隶属函数依据，当域离散，结合个人经验，直接或通过某种方式给出元素隶属度值；
③　例证法：
由Zadeh教授提出，基本方法就是从已知模糊子集的有限个的值，推算出整个域U上的隶属度函数；
④　二元对比排序法：
通过事物之间比较，来确定特征序列顺序，从而确定事物特征隶属函数一般形状。
3.2.6 粒子群优化算法
上世纪九十年代初期，通过对自然界生物群研究，科学家们陆续提出模拟生物群行为的智能优化算法，并对智能优化算法实行广泛研究与应用。粒子群优化算法（PSO）就是其中一种具有很强代表性的智能优化算法，它可以用来解决很大范围内的一类优化问题。
2.2.6.1 粒子群优化算法原理
一般情况下生物个体自身行为并不智能，但应对复杂问题，整个群体行为却表现非凡处理能力。Rednolds对鸟群复杂行为进行仿真时，用三条准则来对个体简单行为进行描述：
①　向目标靠近；
②　远离最近同伴；
③　向群体中心不断靠近。
针对鸟群时而发生分散重组，时而高度同步这些现象，Hepper认为这正是鸟群中鸟之间彼此所保持的最佳距离。另外，Boyd和Recharson探索人类决策过程中，提出个体认知和社会认知概念，这些思想都可看作形成粒子群优化算法的思想基础。
在这些思想基础上，粒子群优化算法（Particcle Swarm Optimization, PSO）是一种进化计算技术（Evolutionary Computation），是在人工生命结果影响下，于1995年由Eberhart博士和Kennedy博士提出，源于对鸟群捕食行为研究。
粒子群优化算法作为一种新兴计算方法主要受到鸟类捕食的启发。在对问题进行求解过程中，将每个优化解都可以看成是一只鸟，并且称为“粒子”，并可以把他们当成具备速度和位置两方面特性的粒子，粒子所处位置可以看作是这个的可行解，目标函数在解决问题过程中主要起到衡量作用，并起到判断一个粒子好坏的标准，目标函数的确定是利用粒子位置坐标得到的。每个粒子通过位置和速度两方面来跟踪个体极值与全局极值，从而可以不断更新自己在解空间的位置，找到问题最优解。
2.2.6.2 基本粒子群优化算法数学描述
粒子群优化算法中每个粒子位置都是优化问题一个潜在解，粒子性能好坏程度由适应度函数值决定，在每次迭代中，粒子在空间中通过不断移动来搜索全局最优解。粒子速度和位置由以下更新公式确定。

其中，上面式子是速度更新公式，下面式子是位置更新公式。i表示粒子群中第i个粒子，d代表空间维度，vi代表第i个粒子速度，xi代表第i个粒子位置, Vi={Vi1,Vi2,…,ViN},  Xi={Xi1,Xi2,…,XiN}, t代表迭代次数。w是惯性权重，w值越大，粒子全局搜索能力就越强；相反，w值越小，粒子局部搜索能力越强。c1,c2是常数，被称为学习因子。代表第i个粒子能搜索到的最优位置，代表所有粒子能搜索到的全局最优位置。函数rand()是一个（0,1）区间内的随机数。粒子搜索过程见图2-7 粒子搜索过程示意图。
 
图2-7 粒子搜索过程示意图
在图中，P代表粒子当前位置，代表粒子自身最优位置，代表粒子群最优全局位置，v是粒子当前速度，是粒子更新后的速度，是粒子更新后的位置。粒子通过, 两个最优位置，结合自身当前速度v，将自身的飞行速度调整成，并由当前位置P飞到位置，完成一次搜索，经过多次搜索后最终到达最优位置。
2.2.6.3 粒子群优化算法流程
粒子群优化算法是一个迭代过程，算法流程具体如下：
Step1：对粒子群中每个粒子速度和位置需要进行初始化设置。
Step2：对每个例子适应度函数值进行计算并评价结果。
Step3：根据例子适应度，按照下面两个式子分别更新各个粒子速度与位置。
      
Step4：更新个体极值。根据速度-位置公式（上式），把每个粒子位置与其记忆中它最好位置进行比较，若当前粒子位置好，则把记忆中位置转换成当前粒子位置，若没有则持续更新。
Step5：更新全局极值。将所有粒子记忆中最好位置与整个种群最好位置进行比较，若粒子记忆中最好位置好，则把整个种群最好位置置换成记忆中最好位置，若没有则继续更新。
Step6：如果具备达到最大迭代次数，可以停止，如果没有达到则返回Step2。
	具体过程见图2-8 粒子群优化算法流程图 
  
 图2-8 粒子群优化算法流程图
2.2.6.4 粒子群优化算法参数分析
粒子群优化算法主要参数有惯性权值，加速系数，种群规模和迭代次数。
(1)惯性权值
惯性权值w对粒子群优化算法能否收敛起重要作用，它可以保证粒子在运动过程中保持惯性状态，并使粒子可以最大范围对空间进行搜索并且对一些新的未知区域进行搜索。如果w取值比较大优势在于可以更有利进行全局搜索，同时收敛速度也比较快；劣势在于不能很有效进行局部搜索，很难保证得到解精度比较高，但劣势就是收敛速度缓慢还会导致因为陷入局部极值，不能得到全局最优解情况发生。所以选择合适w值才能保证在搜索精度，速度，全局搜索和局部搜索相互统一首要前提。
(2)加权系数
加权系数c_1,c_2对粒子群优化算法收敛方面有着很大影响，如果可以恰当选择加权系数，这样不但能保证算法收敛速度，还可以摆脱局部极值。当,粒子就会因为惯性原因保持现有速度，一直向前直到到达边界为止；这时粒子飞行主要依靠惯性原因。所以不能很好在飞行过程中吸取经验或者比较有启发信息，所以这样的算法在启发性方面有所欠缺，同时搜索范围也很有限。也就导致在这种情况下很难找到最优解，与之相对，体现出的优化性能方面也不是很好。
①　当时说明粒子并不具备认知能力，在飞行过程中不能很好吸取经验和比较有效的信息，因此仅仅包含社会部分原因，所以也可以叫做社会参数；尽管在速度方面和基本粒子群优化算法相比能体现出一定优势，但因为在自身飞行信息方面相比还是暴露不少缺点：更容易陷入局部最优，在优化性能方面也有一定差距。
②　当时说明粒子之间不具备社会信息共享能力，当同伴飞行时也不能在同伴飞行过程中获得有效信息，因为仅仅认知部分的原因，所以也叫作认知参数；这时每个粒子之间都不具备互相共享信息，所以在运行过程中群体运行和单个粒子运行几乎没有任何区别，在这种情况下也很难得到全局最优解。
③　通常来说，如果具备当这种条件，会取得不错效果，不少人也认为c_1取值方面应该相对大一些，而在取值方面则恰恰相反，最好可以相对小些，如果可以满足的条件那么结果会更好。
(3)群体规模
粒子群优化算法优化性和群体规模也有非常紧密联系。通常来说，群体规模大小搜索到最优解可能性之间存在着正比关系，如果群体规模较大，那么更容易找到最优解，相对在优化性能方面也能有比较好的体现。但会对消耗的计算量产生一定影响，在计算性能方面也会相对降低；如果群体规模比较小，则很难寻找到最优解，同时也没有过多消耗计算量。所以这就需要我们在解决问题过程中，选择合适群体规模，以防带来不必要麻烦，通常来说，将群体规模控制在10-200比较可行。
(4)迭代次数
当惯性权值与迭代次数不发生关系时，如果迭代次数进行比较多，那么就很有可能找到全局最优解，迭代次数进行相对少一些，在可能性方面也会相对下降一些。在粒子群算法进行优化过程中，如果出现陷入局部极值，并且不采取相应措施，进行再多迭代计算也不会有十分显著效果，消耗计算量也相对比较大，没有什么实际意义。若在优化过程中还有其他条件来结束搜索，可以增加迭代次数，使搜索最优解更可靠。当惯性权值与迭代次数存在紧密联系，即随着迭代逐渐进行，惯性权值也会慢慢衰减，并不代表进行迭代的次数越多越好，反而还会起到反作用导致算法在很长时间内都会以较大惯性权值来搜索，如果这时候不限制粒子速度，粒子就会以很快速度飞到很远处导致最后错过全局最优解。所以，当惯性权值和迭代次数存在紧密联系时，要根据实际情况选择合理迭代次数。
2.2.6.5 粒子群算法特点
与其他优化算法相比粒子群优化算法具有以下优点：
(1)可以同时多点搜索最优解，各粒子间是并列关系，不存在先后顺序限制。与从一点开始搜索的优化算法相比，可以利用更多信息提高搜索效率。
(2)粒子能记住搜索历史中找到的最优解，能保证之前搜索的信息不会随着迭代过程进行而丢失。
(3)优化结果和初始解无关，初始解往往是随机生成。
(4)对种群规模大小并不敏感，即使种群规模变小，算法性能也不会受到太大影响。
(5)数学模型中需调节参数较少，简单易懂，易于实现。
粒子群优化算法有以下不足：
(1)应用方面，粒子群算法主要应用在连续问题上，在求离散化问题上仍需改进。
(2)复杂度方面，粒子群算法原理比较简单且参数少，粒子只通过内部速度进行更新，一次比较容易实现。
(3)收敛性方面，粒子群算法收敛速度较快，方向感较强，但易在迭代过程中陷入局部最优，因此收敛性不能保证。
3.2.7 遗传算法
遗传算法模拟达尔文生物进化原理，通过优胜劣汰准则形成一种优化智能算法，经过几十年不断发展，其丰硕理论研究成果和应用成果，使得遗传算法成为智能优化算法中，应用最为成功也最为广泛的算法。
2.2.7.1 遗传算法基本原理
遗传算法是建立在遗传学基础上的一种数学算法。在自然界中，生物体如果想繁殖后代必须要使自身去适应环境，在逐渐适应环境过程中，物种通过遗传使其基本特征遗传给后代，但是后代所具有特征又与父代不完全一样，若子代能够适应环境存活下来，则子代作为父代继续进行遗传，这就是优胜劣汰原则。遗传算法由一定数量的个体组成的初始化族群开始，其中包含N个父代个体，计算每个父代个体适应值，为了产生出能够适应周围环境的新一代个体，按照适应度值来选择优良个体，根据交叉概率对染色体进行交叉操作，产生出新一代染色体，然后根据变异概率对某些基因进行变异操作，产生出更优个体。所有子代个体再作为新的父代个体并重新计算适应度值，如此往复循环，直到满足优化准则而结束。
遗传算法基本概念和术语如下：
①　染色体：遗传物质主要载体，由多个遗传因子基因组成。
②　遗传因子：决定生物体性状下一代性能和组成的基本单位，又称基因。
③　个体：指染色体带有特征的实体。
④　种群：染色体带有特征的个体的集合称为种群。。该集合内个体数称为群体大小，有时个体集合也称为个体群。
⑤　进化：生物在发展下一代的生殖延续过程中，通过自身改变得到适应周围环境能力，经过变化使得自身体质不断改良，这种逐渐变化的生命形式成为进化。
⑥　适应度：用来衡量某一物种在自然界中的生存适应程度定义为适应度。
⑦　选择：按照一定概率在种群中选取若干有用个体的操作统称为选择。
⑧　复制：旧的细胞信息通过DNA在遗传过程中传递到新的细胞中叫做复制。
⑨　交叉：在交叉操作中，两个染色体在相同的某个位置被断开，然后前后进行交叉，达到重组。
⑩　变异：某些细胞在进行遗传过程中发生小概率事件差错，在这种差错作用下细胞会变成一种新型细胞，产生出新染色体，新细胞从而获得新性状。
2.2.7.2 遗传算法数学描述
	遗传算法具有大规模搜索能力，遗传算法模拟生物进化理论的“万物竞争”原则进行随机思想交换，并按照生物进化优胜劣汰方式进行最优解求解。它尤其适用于处理传统搜索方法难以解决的复杂和非线性问题。这种算法能在搜索过程中自动获取和积累有关搜索空间的知识，并自适应地控制搜索过程，从而得到最优解。遗传算法有六大要素，分别是编码，适应度函数构造，选择，交叉，变异以及算法终止准则。下面对遗传算法六大要素介绍:
（1）编码
①遗传编码
遗传算法对问题进行最优解求解通常对个体进行编码操作，编码操作之后会尽快找到适应度最合适个体，最终达到最优解求解。为了表述一个问题可行解，通常应用遗传算法，将问题解的可行性解，从解空间转换到遗传算法所能处理的搜索空间的转换方式，就称为编码。通常情况下编码方法采用两张方法：二进制编码方法，浮点数编码方法。
以染色体为例对这两个编码的方式进行说明。其中，染色体X中每一位为一个基因，的取值称为位值，n表示X长度。
②二进制编码
用二进制编码对染色体X编码时，的取值只可以取0或1，比如染色体X=(000110)。很多组合优化问题中，其综合评价函数和约束函数都是离散函数，采用二进制编码方式往往具有直接语义，它可以将问题特点与基因对应起来，直观清晰且容易实现。但在处理连续性函数优化问题时，会存在映射误差，如果编码长度过短，会发生满足不了精度要求的状况，影响遗传算法性能。
③浮点数编码
在某一区域范围内，通过一个浮点数，代表种群中每个个体基因值的方法，称为浮点数编码方法。决策变量中所使用的真实值，通常被浮点数编码使用，在这种编码方式中，x_i取值是一个浮点数，例如，X=(5.80,6.90,3.50,3.80,5.00)。由于在浮点数编码方法中，根据决策变量实际值进行编码，因此又把浮点数编码称为真值编码。浮点数编码具有以下特点：
a.适用于在大范围内进行遗传搜索；
b.在遗传算法中可以代表区间内大多数；
c.编码精度高；
d.使遗传算法变得更加容易计算，增加算法使用效率；
e.能使遗传算法吸取其他优秀算法优点，便于结合其他算法组成混合算法；
f.能够使复杂约束条件变得更加简单，容易处理。
（2）适应度函数
	群体中个体生存机会被选择的唯一指标是它们的适应值，所以适应度函数的形式直接决定群体进化行为，为了执行适者生存原则，必须对个体位串适应性进行评价。因此，适应度函数就构成个体生存环境。根据个体适应值，就可决定它在此环境下的生存能力。一般来说，好的染色体位串结构有着比较高的适应度函数值，即可获得较高评价，有着较强生存能力。
为了直接将适应度函数与个体优劣度联系起来，建立适应度函数应该遵循以下三个准则：
a.适应值规定为负；
b.设计必须能够与个体优劣程度一致；
c.计算量应该小。
采用以下两种变换方法可将目标函数f(x)变换成适应度函数F(x)：
a.对于最大化问题，建立如下适应度函数：
,其中，为一相对较小的数。
b.对于最小化问题，建立如下适应度函数：
，其中，为一相对较大的数。
（3）选择操作
选择操作以一定数值选择概率选择种群中适应度值高个体，保留下来生成交配池，而将适应度值低个体淘汰，体现个体适者生存原则。目前，在遗传算法中基本选择方法是轮盘赌选择，这种方法与游戏中轮盘赌类似，基本思想是：每个个体被选择概率与个体适应度值高低成正比。例如：一个种群中个体总数为M，假设个体i适应度值为，那么个体i被选择概率为,计算公式如下：。选择策略具体实现方法是：生成一个随机数r(r∈[0,1]),若,则个体i被选择，很明显概率越大的个体越可能被选中，保留的可能性也就越大。
（4）交叉操作
交叉操作是把两个从交配池中选择出的父个体以一定交叉概率对其结构部分加以替换重组，产生新的两个子个体的过程。交叉目的是使子个体即继承父代特点，又具备父代没有的一些新特点。交叉概率值越大，说明可进行交叉的染色体越多，产生出新染色体也越多。但是过大的值会导致搜索一些不必要解空间，增大计算量，使寻优时间变长，交叉概率取值一般在0.4-0.99之间。
通常使用的交叉算子包括一点交叉，两点交叉，多点交叉，一致交叉等形式，其中最常用的是一点交叉。一点交叉通常的操作方法是：在交配池中选择出来的两个染色体上选择一个断点位置，断点位置随机选择，然后互换断点位置右边部分，产生两个新染色体。交叉操作一般步骤可概括为：
①　从交配池中先随机选择出一对染色体；
②　根据染色体长度，随机选择[1, L -1]中一个或多个整数k作为交叉位置；
③　根据交叉率（0≤≤1）实施交叉操作，在交叉位置处交换两个染色体部分内容，形成两个新染色体。
④　根据对两个染色体,进行交叉操作，则交叉后生成的新个体如下式：	

其中，α是一个参数，若α是常数则为均匀算数交叉；若α随种群代数改变而改变，则称为非均匀算数交叉。
（5）变异
以小概率事件在种群中随机改变某些个体基因值操作过程称为变异操作，即所说的变异概率。通过变异操作，可以保持群体多样性，而且能够防止过早收敛。在变异操作中，若大于0.5，会导致遗传算法随机搜索，导致搜索效率变差。采用自适应变异可以使自适应变化成需要的变异率，可通过下式来改变：。
式中，代表个体最大适应度函数值；代表个体平均适应度函数值；代表交叉中的两个体中较大个体适应度值；代表变异个体适应度函数值。,取值设定在（0,1）范围内，能进行自适应调整。
（6）算法终止准则
遗传算法经过反复进化操作，直到输出最优解满足终止准则才停止进化操作。采用最多的终止准则是规定最大进化代的数目，此外还可以采用群体收敛准则。本设计使用最大进化代的数目作为终止准则，当新一代种群产生时，检验进化代数，看其是否满足给定终止准则，如不满足，就继续生成新一代；如满足终止准则，就把最好个体所代表的分配方案输出给各电梯，从而完成一次优化过程。
2.2.7.3 遗传算法基本流程
根据上述描述，可以得出具体流程为：
Step1：随机初始化群体；
Step2：对染色体适应度函数值进行计算与评价，按适应值大小保留最优染色体；
Step3：对染色体进行选择操作，操作过程中采用轮盘赌选择的方法；
Step4：根据交叉概率P_c，从染色体中选取染色体进行部分交叉，产生新染色体；
Step5：根据变异概率P_m，对染色体基因进行变异操作，保持群体多样性；
Step6：计算新群体中各染色体适应度函数值，更新最优染色体；
Step7：判断是否达到最大迭代次数，若达到则算法结束，若未达到则返回Step3
具体流程参照图2-9 遗传算法基本流程图。

图2-9 遗传算法基本流程图 
遗传算法与其他优化算法相比
(1)具有以下几个优点：
①　直接以目标函数值作为搜索信息。根据目标函数值产生适应度函数，并根据适应度函数确定搜索方向和范围，避免梯度或导数等复杂运算，因此适用于大规模非线性运算。
②　对决策变量进行编码，对一些只具有代码概念的优化问题，其编码方式显示出独特优越性。
③　从多个搜索点开始进行搜索。通过对初始群体进行选择，交叉，变异等运算，反复迭代产生出新一代群体，通过并行性计算提高搜索效率。
④　选择，交叉，变异等遗传算子运算都是以一定概率进行，这使得其搜索的过程中灵活性大大增加。
(2)遗传算法同样也存在以下不足：
①　最优解的效果和算法初始群体的分布密切相关，它以多个个体作为初始状态，根据个体搜索进行群体进化，最终状态是个体所组成，算法维持群体多样性和局部搜索能力较弱。
②　标准遗传算法不一定收敛，主要原因是遗传算法交叉和变异两个算子是按照一定概率发生的，因此算法在搜索过程中获得较好个体不易于维持，优秀个体获得后随时可能消失，而且易出现早熟现象，不能保证全局收敛。
③　遗传算法收敛速度较慢，单独使用时不易在短时间内达到最优结果。
3.2.8  PSO-GA混合算法
将粒子群优化算法和遗传算法相结合，发挥两者优点，构建一种效率更高的粒子群-遗传（PSO-GA）混合算法。粒子群算法（PSO）和遗传算法（GA）都属于进化算法，但是在进化算法中，单一进化算法能力仅靠算法自身操作经常达不到理想优化效果。因此不少研究人员提出将两种算法或者多种算法混合在一个算法中，互相取长补短来实现算法优化。为提高算法局部搜索能力以及避免早熟现象，考虑一种粒子群算法和遗传算法混合的优化算法（PSO - GA）。
粒子群优化算法与遗传算法结合主要是由它们自身特点决定。
遗传算法是根据生物中竞争和优胜劣汰准则，借助选择，交叉，变异等操作，使问题一步步趋于最优解。遗传算法优点是可以搜索到多个局部最优解，同时也具有较好全局优化能力，能够有效利用上一代历史信息来推测下一代有期望能提高的寻优点集。而粒子群优化算法基本思想源于自然界中的鸟群，鱼群等生物群觅食行为研究。该算法融入了个人认知和社会认知观点，通过个人学习优秀者行为，体现算法社会性和智能性，是一种新的全局智能优化算法。
与GA对比，PSO因为没有选择，交叉，变异等操作而更简洁，算法智能性和速度性也更强。但是粒子位置更新主要通过对比自身位置与周围位置，自身位置与粒子群当前最优位置来进行进化，模式单一，使算法在计算后期收敛速度下降，易陷入局部极值；与PSO对比，GA存在交叉，变异等多种进化模式，使解多样性得以提高，但在GA求解过程中，算法求解到一定范围时经常出现大量冗余迭代，计算时间长，求解效率降低。因此，很自然联想到，将PSO和GA算法两者相结合，提高算法效率。
该混合算法基本思想是：首先将种群所有个体进行PSO较小代数进化后，只选取一定个数最优粒子，进行GA遗传操作，其次将经过遗传操作后的粒子与之前最优粒子合并后再送到PSO进行所有个体速度，位置更新，重复迭代后，最终达到最优解。
假设粒子群中粒子个数为P，首先由PSO进化一定代数后，将最优M个粒子保留，去掉P-M个粒子。然后将这M个粒子位置作为基础，通过选择复制来得到P-M个个体，并进行交叉变异等GA运算。最后将PSO保留下来的M个粒子的位置与GA进化得到的P-M个粒子合并，形成新的粒子群，进行下一代进化运算。
具体步骤如下：
Step1：初始化相关参数；
Step2：在可行域范围中生成初始P个粒子，并计算其目标函数值；
Step3：令g=1；
Step4：如果g≤gmax，进入Step5，否则转入Step14；
Step5：令k=1；
Step6：如果k <kmax，进入Step7，否则转入Step9；
Step7：按以下式子更新粒子位置与速度；


Step8：k = k +1,转Step6；
Step9：将P个粒子按目标函数值大小排序，选取其最小的M个粒子；
Step10：由保留的M个粒子的位置值，根据式子，选择复制生成P-M个GA个体；
Step11：将，概率按照式子，进行交叉变异；
Step12：将通过GA生成的P-M个个体与M个粒子合并，组成新的P个粒子；
Step13：g= g+1，并转Step4；
Step14：输出最优目标函数值与最优值（位置）。
详细流程见图2-10 PSO - GA算法流程图。


图2-10 PSO - GA算法流程图
3.2.9  多目标优化模型
3.2.9.1 多目标优化问题
多目标优化问题中各个指标间存在着冲突，优化时应该在各个目标之中权衡处理，一般来说，求解每个多目标优化问题要明确下面5个基本要素：
(1)决策变量：;
(2)目标函数：;
(3)可行解集：;偏好关系：在像集上有某个二元关系反映决策者偏好;
(4)解的定义：如何在已知偏好关系下定义f在D上的最优解。
一个多目标优化问题可描述为：,
满足条件。
式中，为n维决策变量，每个决策变量xi在其最大值xmax和最小值xmin范围内变化；为m个目标函数，满足p个不等式约束和q个等式约束。
2.2.9.2 多目标优化问题解
多目标优化问题解是这样一个决策变量,它可以使目标函数中各个分量取得最小值，一个多目标优化问题通常由n个决策变量，m个约束条件和k个目标函数组成，目标函数性质可能是线性的或是非线性的。多目标优化问题评价函数可以将决策向量映射到目标向量上去。
(1)可行解集（Feasible Solutions Set）
可行解集中所有值经优化函数映射形成目标空间中一个子空间，该子空间决策向量均属可行集。对于多目标优化问题来说各指标是相互冲突的，一个解不可能对所有指标同时达到最优，这就需要在各个指标间进行均衡处理。单目标优化问题的可行解集完全根据单个目标函数f(x)来确定优劣，即对某两个解a,b∈X_f（可行域），总有f(a)≤f(b)或者f(a)≥f(b)成立，优化目的在于找到f(x)(x∈X_f)取极小值的解。但对于多目标优化问题来说情况则不同，因为一般的X_f不是全序的（Total Order），即为偏序（Partial Order）。
(2)解的优劣性（Dominance/Inferiority）
设，称目标向量解优于,如果,记为。反之，称目标向量解u劣于v，如果，∧∋i∈{1,2,…,k},u>v,记为。
如图2-11 多目标空间解关系示意图所示，其中1,2,3,4代表四个可行解，点4表示的解优于点1,2,3所表示的解，点2,3所表示的解均优于点1表示的解；点2,3所表示的解彼此不分优劣。

图2-11 多目标空间解关系示意图
(3)Pareto最优解（非劣最优解，Pareto Optimal）。
决策变量成为上的Pareto最优解，当且仅当不存在，使得优于。
由以上定义可知，Pareto最优解的判断与所在集合范围有关，一般情况下，指的是整个决策空间的Pareto最优解。
(4)Pareto最优解集
    对于给定多目标优化问题，Pareto最优解集ρ*定义为: 
2.2.9.3 电梯群控系统多目标优化数学模型	
(1)电梯群控系统变量
电梯群控系统变量主要由三部分组成，包括：建筑物参数，电梯状态和呼梯信号。
①　建筑物参数：
M：电梯台数；
h:大楼楼层高度；
n：大楼楼层数；
②　电梯参数：
：电梯当前所在楼层；
：电梯当前运行方向；
：电梯运行一层所需时间；
：停靠一层的时间；
m：电梯需响应的停靠服务；
：电梯同向到达的最远楼层；
：电梯反向到达的最远楼层；
③　呼梯信号：
：呼梯信号起始楼层；
:呼梯信号乘梯方向；
(2)约束条件
在电梯群控系统中，应该满足系统的几个最优性能指标约束，一般存在以下几个约束条件:
①　避免乘客长时间候梯：,为乘客候梯时间上限，通常情况下取60s；
②　避免乘客长时间候梯：,为乘客乘梯时间上限，通常情况下取90s；
③　避免电梯超载：,为电梯最大额定容量。
(3)电梯群控系统多目标优化数学模型
在建立电梯群控系统综合评价函数时，根据上述因素，综合了候梯时间AWT，乘梯时间ART，系统能耗RNC三个性能指标，可以推出，第i部电梯响应第j个层站呼梯信号综合评价函数可由下面公式表示：。其中，
：电梯i响应第j个呼梯信号时候梯时间的短评价函数；
：电梯i响应第j个呼梯信号时乘梯时间的短评价函数；
：电梯i响应第j个呼梯信号时电梯能耗的评价函数；
M：群控系统所包含的电梯台数；：权重系数，且；
第k个个体适应度函数可以表示为:。
其中,i表示第k个个体的电梯号，j表示呼梯信号，L表示呼梯信号个数，为第j个呼梯信号被指派给电梯i的评价函数值。表示在种群中第k个个体所代表的分配方案性能优劣，越大，分配方案越好。以下是计算的方法：
①　候梯时间短评价函数:，WT为候梯时间。
②　当新的呼梯信号发生时，根据呼梯发生的楼层FC以及方向Dc与电梯当前所在层F0和方向D0，可计算出电梯到达新呼梯信号所需要的时间，即候梯时间。
③　当Dc与D0相同，且FC在F0前方时，电梯可以同向到达乘客呼梯信号：

④　当Dc与D0相同，且FC在F0后方时，电梯先反向运行后再同向到达乘客呼梯信号：

⑤　当Dc与D0相反，电梯反向运行后到达乘客呼梯信号：

⑥　当Dc与D0相同，且，
⑦　乘梯时间的短评价函数
为电梯i响应第j个呼梯信号时乘客乘梯时间。由于产生新呼梯信号时只知道乘客乘梯方向，而不知道目的层，假设乘客目的层是最远楼层，那么乘梯时间计算式为：

⑧　能量消耗的评价函数
电梯在运行过程中，起停过程中会产生比较大的能耗，因此减少电梯的起停次数和电梯运行中加减速距离成为减小系统能耗的关键。为简便起见，可以将轿厢i在到达第j个呼梯信号所在的楼层前需要停靠的次数n(t)来表示此台电梯的能耗。那么，电梯i能源消耗的评价函数可表示为：。
权重系数的选择对电梯群控系统运行效率的改善有很大影响，因此在对权重系统的选择上要对当前电梯所处模式进行详细分析。在不同交通模式下对权重系统的选择也要有不同的侧重。例如客流高峰时电梯群控系统群控策略主要以减少候梯，乘梯时间为主，因此可以增大fw和fr的权重系数w1和w2；在电梯空闲模式时，主要以减少能量消耗为主，可增大fe的权重系数w。下表表示的是不同模式下所对应的权重系数。权重系数wi初始值见表2.1 不同模式下对应权重系数。(权重初始值只用于借鉴，后期经过训练逐步调整)
表2.1 不同模式下对应权重系数     
交通模式	w1	w2	w3
上行交通模式	0.60	0.20	0.20
层间交通模式	0.50	0.20	0.30
下行高峰模式	0.55	0.20	0.25

综上，综合评价函数是三个评价指标加权平均值，因此，假如我们对某一个评价指标赋一个比较大的权重系数，那么电梯的指派就会受到该评价指标值变化的较大影响，主要按这个指标对电梯进行调度分配。
3.2.10  PSO-GA混合模型步骤
利用粒子群算法的局部搜索能力和遗传算法的选择，交叉，变异协同寻优，从而构建相应模型。首先进行粒子群算法操作，计算电梯群控系统综合评价函数适应度值，选取适应度值最大的一些粒子进行下一步遗传操作的选择，交叉，变异，判断是否达到迭代次数，如果达到最大迭代次数，则输出最优解。选取最优个体具体实现步骤如下：
Step1：初始化相关参数。
粒子群个数P；经过粒子群运算进化后保留的粒子个数M；PSO学习因子,；GA交叉与变异概率,;粒子最大速度，以及PSO进化代数与混合算法总的进化代数，产生乘客流。
Step2：编码。
以电梯作为编码对象，通过实数编码方式进行编码。具体形式如下：假设电梯台数为4部，“1”代表第一台电梯响应某楼层的上行呼梯信号，“2”代表第一台电梯响应某楼层的下行呼梯信号,“3”代表第二台电梯响应某楼层上行呼梯信号，“4”代表第二台电梯响应某楼层下行呼梯信号，以此类推，可以得出对应编码的码数共有8个，即：“1”，“2”，“3”，“4”，“5”，“6”，“7”，“8”。
Step3：生成P个初始粒子群。
假设某幢建筑共有16层，则粒子维数为16。粒子中每个元素均为0-8中的整数，生成粒子形式如下：
楼层数	1楼  2楼  3楼  4楼 …	 13楼  14楼  15楼  16楼
编码	3	6	0	4	…	2	5	8	1
每个实数即为响应该楼层乘客呼梯的电梯号，例如第1楼层下面的“3”即表示由第二台电梯响应1楼的上行呼梯，第3楼层下面的“0”表示该楼层没有呼梯信号。
Step4：适应度值计算。
根据乘客呼梯信号和电梯当前状态，根据前三个式子分别计算每个粒子的，第四个式子即个体适应度函数计算出粒子适应值；

Step5：令g=1;
Step6：如果g≤gmax,进入Step7,否则转Step16；
Step7：令k=1;
Step8：如果k≤kmax,进入Step9，否则转Step13；
Step9：对粒子群中粒子进行位置和速度更新，并更新个体和全局极值。
Step10：k= k+1；转Step8；
Step11：将P个粒子按目标函数值大小排序，选择其最小的M个粒子；
Step12：由保留的M个粒子的位置值，选择复制生成P-M个GA个体；
Step13：以Pc,Pm的概率分别进行交叉和变异；
Step14：将通过GA生成的P-M个个体与M个粒子合并，组成新的P个粒子；
Step15：g= g+1，并转Step6；
Step16：输出最优目标函数值与最优解（位置）。
详细流程见图2-12 PSO - GA混合模型流程图。

图2-12 PSO - GA混合模型流程图
3.2.11 模糊控制与神经网络结合
模糊逻辑系统是以模糊集合论为基础，源于人类思维模糊性特点。对于用一般常规方法难以解决的问题，用模糊逻辑来推理和处理能够很好对复杂事务进行模糊度量和识别。模糊系统重要特点是具有较强逻辑功能，在模糊控制系统中，虽然模糊推理是一种善于表达知识的推理方法，但模糊系统从本质上并没有获取知识能力，模糊规则确定也通常需要依赖和借助专家知识和经验等指导，因此比较难以确定。而人工神经网络能够通过学习和训练获取用数据表达的知识，除了可以记忆已知信息外，人工神经网络还具有较强概括能力以及联想记忆能力。人工神经网络理论应用已渗透到各个领域，并且在智能控制，计算机视觉，模式识别，自适应滤波，非线性优化，信号处理，知识处理等方面取得令人鼓舞进展，但是人工神经网络研究理论体系还不完善，存在一些缺点，例如权值随机选取，无法利用系统信息，和专家经验等语言信息，学习时间长，网络参数缺乏明确物理意义等。
随着对模糊系统和神经网络这两个领域研究深入，它们之间相互独立关系逐渐改变。学者们将模糊系统和神经网络融合正是为了获取两者优点，使得两者能够优劣互补，这种融合导致模糊神经网络出现。模糊神经网络是按照模糊逻辑系统运算步骤分层构造，再利用神经网络学习算法模糊系统，它不仅改变模糊逻辑系统基本功能，如模糊化，模糊推理，解模糊化等。模糊神经网络吸取模糊系统和神经网络优点，并部分避免两者缺点。
2.2.11.1 网络训练
将模糊神经网络正式应用于交通模式识别前，需要进行训练。网络进行训练主要是为了让网络模型对训练样本以外数据具有正确映射能力，训练过程实际上是网络对训练样本内在规律学习过程。为了使网络中各个权值更为合理，需对网络加以训练和验证，使其具有权系数，进而得出合理评价函数值。
训练网络主要步骤：对于给定输入向量p，计算网络实际输出a，并与相应期望输出t进行比较，得到学习误差e，根据学习规则进行权值和偏置量调整，重新计算网络在新权值作用的输出与重复权值的调整过程，直到网络输出与期望值相等，或者训练次数达到预先设置最大值。


3.3  目的楼层预约电梯群控调度算法研究现状
目的楼层预约呼梯群控系统将上行/下行按钮和选层按键合二为一，将候梯大厅的上下行按钮省去，取而代之的是可以选择具体楼层的全数字键盘。乘客只需在数字键盘中选择要前往的目的楼层，电梯系统在接收到乘客的请求之后，通过系统的派梯调度算法计算出最优的派梯命令，在候梯大厅的数字键盘显示系统给出的派梯信号，通知乘客到指定电梯处等待，引导乘客合理乘梯。
目前在国内外，对目的层预约的电梯群控策略的研究还处于起步阶段，日本学者[13]针对单梯的目的层预约算法进行了研究，但是没有针对多台电梯的群控调度进行研究。国内学者对目的层预约的电梯群控调度算法进行了初步研究，例如，许玉格等[14]提出了一种多目标模糊神经网络电梯群控策略，把目的层预约电梯系统的特征属性作为多目标模糊神经网络的输入，建立并训练模糊神经网络，最后利用该模糊神经网络进行派梯计算。罗飞等[15]提出了基于改进型粒子群算法的电梯调度策略，根据目标函数和呼梯信号产生相应的粒子群，通过更新算法更新粒子群，对粒子群进行全局搜索，直到确定目标层。孙朋飞[16]针对现有电梯群控方式存在的不足，采用目的楼层预约的模糊控制群控算法进行优化，通过模糊推理计算每个评价指标的可信度和总适应度，将总适应度最大的电梯作为响应电梯。
第四章 电梯群控系统的交通流分析研究
4.1乘客交通流描述
交通流是运用物理和数学的定律来描述交通特性的一门综合性的科学，它能很好地解析交通现象及其本质。通过掌握其规律加以研究，使其发挥最大功效，乘客交通流是其中的一种典型应用。
乘客交通流是一类含有乘坐电梯人数、出现呼梯需求的时间及乘客目的层站的分布等信息的状态量。通过对其分析研究，可以将其划分为不同的模式。不同的模式下，电梯群控系统的派梯侧重点有所不同。通常分为以下四类：上行峰值模式、下行峰值模式、层间运行模式、空闲交通模式。当处于高峰时段时，电梯群控的派梯侧重点是偏向快速输送乘客。当系统处于非高峰时段时，电梯群控的控制侧重点聚焦于如何有效降低系统的能耗。
1.上行峰值模式：该模式对应于上班的早高峰时段。此模式下，乘客的起始层往往低于目的层，多集中于一楼大厅，客流量较大且较为集中。因此，在派梯的时候往往考虑以降低乘客的平均候梯时间及平均乘梯时间为为首要目标，而其他指标作为次要考虑因素。图所示为上行峰值模式示意图。

图是新加的，后续重新画
图为某大楼早晨 7：00-9：30的乘梯人数示意图，通常选取五分钟作为数据采集周期。为了便于研究，从总体上反应不同模式下的人流变化情况。因此，在进行示意图的绘制时选取每十分钟作为乘梯人数的采样周期作为研究对象。由图所示：在7：00有乘客开始进入到 8：50 的整个过程中电梯中乘坐电梯的人数在不断增长，在 8：40-8：50 达到了峰值。
2.下行峰值模式：该模式对应于下班的晚间时段，此模式下乘客的起始层往往高于目的层，与上行峰值模式相同情况下，同样以乘客平均乘梯时间及其平均候梯时间为重点考虑目标作为派梯的重要决策依据，图为下行峰值模式示意图。
图是新加的，后续重新画

图为该大楼晚17:00-19:30 乘梯人数示意图，由图可知在18：00-18：10乘梯需求达到了峰值。
3.层间交通模式：该模式对应于大楼的正常工作时间。此模式下乘客的起始层与目的层往往有较强随意性，乘坐电梯人数数量明显降低。此时，我们应当以降低电梯的能耗为决策重点。可以使用部分电梯进行运输乘客，其余部分可以进行“休眠“，图 为层间交通模式示意图。

图是新加的，后续重新画
该图为该大楼 9：30-10：50 乘梯示意图。图中所示，各个时段乘梯人数较为平均没有明显的变动。
4.空闲交通流模式：该模式对应于非工作时间的节假日及其每天的晚上时段。此模式下由于乘坐电梯的人相对于层间交通数较少，将进一步强化电梯群控系统的节能意识，提高电梯能耗指标的权重，从而进一步达到节能的效果。群控控制器可以对电梯的状态信息进行实时获取。为了使电梯的运行效率达到最高，在上行峰值模式下，我们将轿厢内1层按钮设置为常闭。这样系统在执行完上行任务时，可以快速的返回基站进行下一次的乘客接送。同时为了提高电梯使用率，将 2-4层按钮的功能进行暂时屏蔽，4楼以上的功能正常。在下行高峰值模式下，使多部电梯处于不同区域之内，可以有效缩短乘客等候电梯时间。
4.2 交通流模式的判别
交通流模式的识别有着极其重要的作用。由于不同的交流通模式对应不同的权重模式，对电梯的评价调度系统有着很高的影响。因此，交通流模式的识别有着及其重要的意义。当电梯群控系统进行工作时，交通流模式识别模块已经训练完毕，其可以对当前的交通流模式可以有效的判别。群控控制器通过对交通流模式的判别可以在线对参数进行调整，其工作示意图如下图


    图 电梯控制器工作示意图
交通信息可以进行实时采集，将采集到的数据发送给控制器交通流分析模块进行分析研究。根据交通流的特征变化，交通流分析模块进行分析研究，最后做出结果送控制器。如果该时刻人流与上一时刻人流同处一个模式，那么系统不用对控制参数进行改变。
1.  交通流数据采集模块
 交通观测数据取自某办公建筑，根据通用的研究方法，每 5min采集一个交通数据。每天7：00-20：00 共 159 组数据，采集时间为周一至周五[34]。
2.  交通流数据分析模块 
交通流分析模块，主要是针对当下乘客的数量进行分析。当乘客人数发生变化时，系统可以根据人流的变化，得出当前的交通流模式。BP 神经网络由于其有较好的预测能力，已经被广泛应用于函数逼近、模式识别、分类等领域。因此，选用BP 神经网络对交通流模式进行模式识别，其在交通流模式识别的过程如下所示：

我们是随机数据，这里的写法要请示老师

4.3 不同模式下的权重选择
由于大楼一天出入的人流量存在较大的变化，因此对于乘坐电梯人员的数量波动也较大。在不同的模式下，设计人员考虑的侧重点有所不同。例如，在人员出入密集时段，我们考虑的主要是能如何快速的去执行呼梯请求，在短时间内运输大量的乘客。因此，应当重点考虑降低乘客的候梯时间及其乘梯时间。在非工作时间及其节假日时，应重点考虑电梯的有效节能。当侧重于某一方面时，我们就要在权值的分配上加大权重所占比。
根据经验，得出如下图所示的权重表。
表 不同模式权重表
	平均候梯时间（AWT）	平均乘梯时间（ART）	平均停靠次数（ANS）
上行峰值模式	0.6	0.3	0.1
下行峰值模式	0.5	0.4	0.1
层间运行模式	0.3	0.3	0.4
假日运行模式	0.2	0.2	0.6
w1，w2，w3分别代表AWT、ART、ANS的权重因子。由以上表格可知w1+w2+w3=1,当某个权重因子发生变化时，会对其他权重因子造成影响。
4.4人员数量的确定
我们是随机数据，这里的写法要请示老师

第五章 目的层预约型智能电梯群控系统模型
5.1 目的层预约系统的工作原理
为了降低电梯群控的信息不确定性，传统的方法是根据人流特征提取出相应的数学模型，根据一系列特征量进行预测研究。但是，由于人流的随意性及其不确定性，导致该方法所做出的预测结果不精确。基于以上情况，故引入了目的层预约系统。以往的电梯外呼系统只是包含每层的上行、下行按键。系统只可以知晓乘客的出发楼层，却无法获知乘梯人员到站的目的地层。这样系统知道的乘客信息越少，系统做出最优控制的几率也越低。相较于传统的电梯，由于其目的地站知晓，在乘客还未进入电梯之前就获取了相关信息。EGCS 可以利用这些信息进行分析决策，做出最佳的派梯策略，从而提升电梯的控制性能。
目的层预约系统较之传统的呼梯系统，其独特性在于取消了每层的上下按键。将轿厢内的楼层选择按钮加装在每一层。通过其新颖独特的功能，电梯控制器可以提前获知乘客目的层信息，有利于电梯群控系统做出最优的决策。
目的层预约电梯的提出是为了更好的发挥乘梯群控性能，提高乘梯的使用效率。它区别于传统意义上的电梯是轿厢内部按钮被放置在每层的厅层墙面上。乘客根据意愿，按下相应的目的层。电梯群控系统记录相应的信息，完成乘客信息的获取，为决策系统提供乘客目的层信息，以便于系统做出合理的决策。例如，三部电梯中都有人按下了相同的目的层。传统的派梯规则中，可能会产生一种情况，三部电梯同时相应该层召唤。但是，由于采用目的层可预约技术，控制器在决策时可以安排一部电梯去响应该层召唤。这样不仅提升了电梯的使用效率，同时也降低了电梯运行的能耗。当乘客呼梯产生的目的层信息与当前某个轿厢同方向时，系统优先考虑派其去执行呼梯响应。下图为目的层预约工作的示意图。

其中，当电梯呼梯板被按下时，呼梯信息会被电梯群控模块接收并记录，群控模块根据乘客的目的层信息以及电梯当前所在的位置以及运行状态做出虚拟的派梯进行对比，最后将最优派梯方案传输到单个电梯控制模块中。基于目的层预约的EGCS数学建模属于多目标建模优化的范畴，通过选取四个评价指标构建综合评价数学模型来进行最优方案的选取，即平均候梯时间、平均乘梯时间、平均停靠次数，电梯能耗。

5.2基于目的层预约的电梯群控系统的数学建模
呼梯分配形式可做如下简化:根据呼梯面板可以得到一个呼梯信号，当时，表明产生了一个上行的呼梯信号。当时表明产生了一个下行的呼梯信号。系统虚拟的将每一部电梯分配给每一个呼梯队列进行运算，经过决策产生一系列执行的派梯方案。
基于目的层预约的EGCS数学建模属于多目标建模优化的范畴，通过选取多个评价指标构建综合评价数学模型来进行最优方案的选取。
5.2.1基于目的层预约的电梯群控系统的数学建模
多目标优化是指在根据实际条件建立好的数学模型基础上，将线性规划及非线性规划研究的给定的约束集合上将多目标函数转换为单一目标求的最大或最小的问题，即方案的好坏是以一个评价值去平衡量。
在众多具体的应用实例中，一个指标是通常无法对总体方案的优劣进行有效评价的。也就是说，需要用一个以上的目标去判断方案的好坏，而这些目标之间往往不是那么协调，甚至是相互矛盾的。如何达到一种各方的平衡使目标值达到最优。
常见的数学模型有如下的两种表达方式:


其决策过程可转化为如下的一般形式：


在满足约束条件的基础上，根据实际需求，求解目标函数的最大或者最小值，从而为系统的优化选择最佳的方案。

5.2.2 基于目的层预约的电梯群控系统建模约束条件
在群控系统设计时，我们首先要考虑到乘客乘梯的这一重要因素。当乘客在等候电梯时，总希望能在摁下呼梯按键后，电梯能快速到达。乘客等候乘梯时花费的时间越短，乘梯人员的满意程度也随之越高。当等候时间超过一定时间后，心理的不满意度会明显升高。长时间的等候，电梯没有应答，会导致乘客步行离开。对于乘客来说，浪费了等待的时间。对于电梯而言，乘客没有进入电梯，造成了一次“空跑”。因此在设计时，应当充分考虑乘客的因素。尽量缩短乘梯人员的等候时间，由于目的层技术的使用，系统可以提前知晓乘客的乘梯信息，可以将其控制在合理的区域内。在乘坐电梯时，我们希望电梯行驶的速度越快越好，这样可以快速的前往目的地。但是速度较高时，乘客会出现明显的不适应症状，（如头晕等）。因此，电梯速度须在乘客可以接受的范围内。由于轿厢环境的封闭性，长时间的乘坐电梯会给乘客带来较大的不适。因此，电梯设计时应考虑到乘梯时间这个因素。
在满足乘客需求的同时，也应充分考虑大楼管理者的诉求，如何有效的降低电梯运行的能耗。而在电梯的运行的过程中，轿厢的启动与停止的过程中所产生的能耗远大于电梯高速运行的状态中的能耗。因此，减少电梯的空跑现象对于提升电梯的运输效率显的尤为重要。上诉的三个因素中，单一的某个因素的性能提升无法有效的满足电梯的群控系统的需求。因此，将三个目标进行统一规划，从中选取最佳的派梯方案既是我们追求的目标。
5.2.3 目的层预约的电梯群控系统的理论模型确立
当优化目标明确以后，问题解决的症结在于怎样确定正确的多目标函数优化模型。候梯时间、乘梯时间、停靠次数三个参数作为整体的评价指标，其综合的评价值可以用来衡量电梯群控的控制性能。因此，建立了如下公式(4-3)所示的快速评价目标函数来对每一组可行派梯方案进行实时评价:

其中，为候梯者等候时间快速评价准则函数; 为乘梯者乘梯时间快速评价准则函数; 为EGCS系统的停靠次数快速评价准则函数。
在优化的目标函数确定以后，在产生的一组呼梯序列中，其、、的值都可以确定。、、的值可以通过交通流模式的确定而确定。
5.2.4 评价指标的数学模型的确定
1. 候梯时间评价函数的确立
乘客等候电梯时间是指有乘梯需求的人按下呼梯按键到系统经过控制决策得出的轿厢到达该目的地层开门执行运送任务所需的时间。而电梯的行驶包括加速阶段、匀速阶段，减速阶段三个部分。为了简化计算，电梯行走一层的时间T1，电梯停靠一层的时间为T2，来代表电梯的加速、匀速、减速阶段所花费时间。下图 4-2 为电梯运行示意图。
通常将电梯的运行分为以下两种模式⑴是否与电梯运行方向相同⑵电梯的呼梯层是否高于电梯当前的所在楼层。

图4-2 电梯运行示意图
在上行的过程中，当即将前往的目的地层位于轿厢当前运行方向所在楼层之上时，其候梯时间表达式为:

当前往的目的地层位于轿厢运行方向所在楼层下方时:

乘梯向下运行的状况与向上运行的情况类似。定义为轿厢j应答第i个呼梯请求时所花费的时间。于是乘梯i应答该梯全部M个乘梯响应时时花费时间为，最后可以计算出在本次的呼梯序列中，N部轿厢应答所有的呼梯请求花费时间为，候梯时间快速评价时间依据如下: 

其中，为呼梯层的个数。
候梯时间的评价函数为:

其中，为候梯快速评价的时间依据。
通过权威的调查数据研究证实，60s的等待时间会使乘梯人员心理的烦躁情绪迅速攀升。一个优秀的评价决策系统，应充分考虑乘坐人员的诉求。于是，在实行乘梯的决策的调派时，应当使乘坐人员的AWT尽量少于60s，下表4-1为候梯时间快速评价函数值对应表。
 表 4-1 候梯时间快速评价表
awt	10	20	30	40	50	60
fawt	0.852	0.527	0.237	0.077	0.018	0.005
从表中可以很容易看出，候梯者等候电梯的时间越久，其相应的目标值也越低。所以其等待时间有效的降低，可以极好为乘梯人员更好的的服务。也证明了该数学模型的有效性。
2.乘梯时间评价函数的确立
乘坐乘梯所花费的时间是从乘梯人员步入乘梯开始计时，直至抵达目的地层所花费的时间。由于乘客的起始层与目的层已然确定，决策系统可根据以上信息计算出相应的乘梯所花费的时间，然后再结合其他决策指标做出最佳的派梯选择。乘梯时间的计算方式与候梯时间所采用方式相同。因此，不多做说明。乘梯时间评价准则如下:

其中，是个呼梯请求预计的乘客乘梯时间。乘梯时间评价函数为

乘梯需花费的时间可分为两部分:一部分是乘梯正常行驶所需时间，另一部分是乘梯梯停靠送客所花费时间。值的确定，可得到对应的函数评价值。表4-2为乘梯时间函数评价表。
表4-2 乘梯时间函数评价表
art	10	30	50	90
fart	0.931	0.523	0.165	0.003
art为该组派梯任务的预估评平均乘梯时间。由表 4-2 可得，乘梯内的人员在轿厢内逗留的时间越长，评价目标值也相应的更低，显现了该指标评价函数的正确性。
3.停靠次数评价函数的确立
多部电梯的运行对电能的消耗是巨大的，其能量消耗主要来自于有呼梯需求时电梯的加速启动以及到达目标层减速停止的过程以及其接送乘客的运行过程。因此，降低无效的启停次数可以有效降低电能消耗。EGCS 停靠次数快速评价准则函数为:


其中，ans为执行该组派梯任务时平均停靠次数，其计算过程如下:

其中，表示轿厢的个数，表示该组派梯任务电梯总的停靠次数。
以20层电梯为例。平均停靠次数的取值范围为[0，20]，表4-3为系统评价表。
表4-3 停靠次数评价表
ans	1	5	9	20
fans	0.931	0.427	0.064	0.0000012


为可行派梯任务中的平均停靠次数，从表 4-3 中可以得出:平均停靠次数越多，其指标函数评价值越低。当平均停靠次数达到 20次时，几乎每一层都会停靠，此时在乘梯内的乘客会感到极大的不适感，同时电梯的能耗也非常巨大。因此，在进行派梯优化时，调整此类派梯方案的评价值，使其处于非优先序列。
第六章 实验设计
6.1 实验原理
交通模式，客流量仿真的目的。以单智能体为基准，从所有方案中，抽出最适合的方案，简单到复杂。次要问题，竞争机制，非合作机制(本方案的基本思想)，从思维上解决了遗传算法想解决的问题。
深度强化学习
伪代码
function(props)
var {epochs, T, batchSize, C, environment, ε} = props;
var θ = init();
for(var epoch in range(0, epochs)){
for(var t in range(0, T){
/*选取动作，其中函数Φ用来将状态处理成模型入参并可能做一些额外转换以及其它数据操作，例如加入前几次状态等*/
var at;
if (Random.rand() > ε){
/*等模型训练完之后，这一行就是最常执行的操作*/
at = arg maxa Qθ((st),a);
}else{
at = Random.rand(Action.shape);
}
var{st+1, τt} = environment(st, at);/* τt是当前状态的奖励，一般不包含未来的*/
Cache.insert({Φ=Φ(st), a=at, τ=τt, Φ’=Φ(st+1)};/*积累经验*/
/*从经验回放取出一定量的数据参与拟台，当然，经验数量不够也不能凭空生出来*/
for (var {Φ, r, a, Φ'} in Cache.selectRandom(batchSize) { 
var y = ri + γmaxa’Qθ(Φ’，a’);
θ -= ▽θLoss(Qθ(Φ，a),y);
}
if(t % C == 0){
/*每隔一定步数就用Q的参数θ更新一次Q=Qθ；可以采用“软更新”*/
ˆθ=update(ˆθ, θ);
}
}
}
/*其实返回ˆθ和θ差不多，团为此时模型己经收敛，两组参数差异微小*/
return 0;
}

行动参数更新

 def choose_action(self,observation):  
     observation = observation[np.newaxis,:]  
     if np.random.uniform() < self.epsilon:  
         actions_value = self.sess.run(self.q_eval,feed_dict = {self.s:observation}
          action = np.argmax(actions_value)#选择最高价值的行动  
     else:  
         action = np.random.randint(0,self.n_actions)  
     return action  

经验池

 def store_transition(self,s,a,r,s_):    
     if not hasattr(self,'memory_counter'):    
         self.memory_counter = 0  #计数器    
         transition = np.hstack(s,[a,r],s_)  
         index = self.memory_counter%self.memory_size  #样本数量超过经验池大小时开始覆盖    
         self.memory[index,:] = transition    
         self.memory_counter += 1    


学习函数

def leran(self):
	q_traget = q_eval.copy()
	batch_index = np.arange(self.batch_size,dtype = np.int32)
	eval_act_index = batch_memory[:,self.n_fextures].astype(int)
	reward = batch_memory[;self.n_fextures +1]
    q_traget[batch_index,eval_act_index] = reward + self.gamma * np.max(q_next,axis = 1)
    -,self.cost = self.sess.run([self._train_op,self.loss],feed_dict ={self.s:batch_memory[:,:self.n_fextures],self.q_traget:q_traget})
	self.cost_his.append(self.cost)


6.2 实验思路
图形化的解决方案、技术分析文档介绍
6.3 实验解决问题
1.防错机制(比如整栋楼所有层都有人按下，几部电梯的计算结果耗费时间一样时，电梯的次序，这种情况一般理解为软件开发中的测试人员找极端情况的bug)、
2.奖励函数的设计
6.4 实现困难
1.算力问题
2.方案:分布式边缘计算
3.子问题的完善与构建 
6.5 配套子方案的设计
禁停楼层
电梯超载时，抛弃的人员(先来先服务，预约顺序)
紧急情况下的最大承载量的计入
VIP的插入
极端情况（比如时间花费一致）

对电梯不可用状态的排除的顺序

电梯环境设置
80层楼、8部电梯、每部电梯可以搭载10人(大部分住宅楼宇的电梯,承重是800千克到1000千克。有的不写直接数据的、基本上会写8人到10人之类)

新方案实验的对比对象
专家系统(略，上世纪，问答系统，微软，语言专家问题)、模糊控制、遗传算法、旧的调度算法、普通强化学习算法、DQN算法、A3C

6.6 公式改进

(详细版本的参数后面加上，这里出个大概)
T代表电梯群花的总时间,T1代表第一台电梯所花的时间
Q代表电梯,Q1代表1号电梯的情况
S代表电梯的状态,S1代表1号电梯的状态
a代表行动，a1代表1号电梯的行动

与原版DQN公式对比

6.7 模型概述

人工神经网络（Artificial Neural Networks，简写为ANNs）也称为神经网络（NNs）或连接模型。它是一种算法数学模型，以模仿动物神经网络的行为特征，进行分布式并行信息处理。这种网络依赖于系统的复杂性，通过调整大量内部节点之间的互联关系来达到处理信息的目的。

图3-1 神经网络结构

本质上是多个线性模型(Linear algorithm)的组合
比如，逻辑回归模型是进行二分类。 


DQN算法
DQN算法介绍
https://blog.csdn.net/CSDNXXCQ/article/details/117354917?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166514163616782427468062%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=166514163616782427468062&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-117354917-null-null.article_score_rank_blog&utm_term=DQN&spm=1018.2226.3001.4450
6.8 环境设计
本次环境想定为80层楼，8部电梯，目的在于作为复杂楼层背景下目的预约型电梯应用的一个参考
看成一个方块小游戏，游戏的目标就是让红色尽可能地到达有黄色的地方，注意，红色只能上下
在这样的条件下，为每部电梯嵌入一个这样的游戏，在运算过程中，以尽可能多的碰到黄色为目标，比如有4部电梯，ABCD，ABCD各自进行运算，分别算出各自到达所有黄点需要的时间，然后将这个数据传入一个计算机进行比较，谁最快就让谁去，而我们只需要把黄点随机的打出，当该黄点遍历过所有地方，就是我们经过的所有情况。(进一步的优化:引入客人人数，计算乘梯时间)

红色:电梯

白色区域:代表X*X的大厦
长代表一层有几个电梯
高代表有几层楼

黄色代表
那一层有用户按下
黄色可以有多个
6.9 特征工程
6.9.1 思路讨论
电梯调度本身要解决的问题
○1电梯群控系统考虑问题
	电梯动态特性：额定速度、加速度、运动时间、加载/卸载乘客数量；
	评价准则：平均候梯时间、长候梯率、能耗统计值；
	评价方法：主要有仿真方法、模糊专家系统方法和神经网络方法；
	层站呼叫指派方法(HCAM)：当一个新的层站呼叫发生时，HCAM需完成3个步骤:输入当前交通条件、性能预测及确定服务轿厢；
	交通量自适应性：用已知的当前交通数据预测层站呼叫的发生情况，估计可能指派而后作出决策；
	再指派能力：根据最新系统条件重新作出指派。
○2电梯交通模式(初步看来可以无视，后续电梯的放置可以考虑)
	上行高峰交通模式：所有乘客均由建筑物底层（基站）大厅进入轿厢,当电梯把乘客送至各自目的层后,直接返回基站,重复执行运送基站乘客的工作；
	午餐交通模式：所有乘客到底层用餐之后返回各自的楼层；
	下行高峰交通模式：所有乘客都运行至基站；
	层间交通：这种模式主要特点为上行和下行乘客所占比例大致相当，且乘客数量具有随机性，各层之间交通需求基本平衡，此模式情况下不能对乘客服务需求层做出准确预测。
	空闲交通：楼层客流稀少，不足以使用全部电梯，而让其余电梯正常服务。
	其中上行高峰与下行高峰不是简单顺序倒置，下行高峰有多个到达(起始)楼层，而只有一个目的层；上行高峰仅有一个到达楼层而有多个目的楼层，这种区分意义在于准确估计乘客平均候梯时间。交通模式识别是电梯群控系统一项重要内容，是调度策略优化必要前提。
○3其他电梯交通模式
	上行交通模式：当主要交通流是上行方向，即大部分乘客呼梯楼层在建筑物基层，目的楼层为以上各层的情况，被定义为上行交通模式。
	下行交通模式：当主要交通流是下行方向，即大部分乘客是从各个楼层乘梯下行到基层离开建筑物，这种情况被称为下行交通模式。
	层间交通模式：当上行和下行乘客数量大致相同，这种情况定义为层间交通模式。层间交通模式分为以下几种情况：
	□1当主要交通流朝着除基层之外某一层而来或从该层去往其他楼层，称为两路交通模式；
	□2当主要交通流是朝着某两层而来或由某两层去往其他各楼层，称为四路交通模式；
	□3当上行和下行乘客数量大致相同|起始楼层和目标楼层比较分散，称为随机层间交通模式。
	□4空闲交通模式：当大楼交通流稀少，这种情况被称为随机交通模式。
客流量仿真与电梯的交通模式，本质上都是为了搞清楚电梯应该在客人多的情况下怎样布局，或者说，分别布局在第几层从而达到节能与效率的目的
这也是一般/传统方案中，参数变得复杂，从而导致算法复杂的最根本原因，我接下来要提出的方案是立足于思路上的转变，从解决问题的思路上，绕开这个问题，在参数简单的情况下，让电梯的效率达到最优(耗费时间最短)
本方案立足于电梯调度的第一目标:调度完成后，调度时间最短。第二目标，节能。考虑到我们的电梯属于高层定制预约制电梯，一个核心点就是，这些老板不缺钱，节能是非常次要的目标，效率才是第一。同时第一目标与第二目标有所关联，一定程度上，调度所耗费的时间越短，使用的电能就越少，立足于这样的情况，我们将切口切小，这是一种追求效率的电梯，目前只是让运输的时间最短。
注意，我们将所有过程都视为静态，黄点的不同则代表了情况的不同，从而实现动态过程向静态过程的转化
本质:将电梯的所有情况都记录下来，需要的时候对照对应的方案，选择速度最快的方案调用
考虑到我们的电梯是预约制电梯，一层楼中用户按了其中一个，就代表整层楼给按了，那么对于每个电梯(每个电梯是一个智能体)在他的通道来说，那么就是他的目标，那么我们只需有一个电梯在一个方向上就可以了，也就是说，我们是直接比对，选出预制的最优方案，从理论上来说，这个方案就是最快的，因为计算机只需要做一个简单的比对或者说选择.，这样操作无论有几部电梯，我们只要直接部署对应数量的分布式计算机就能解决问题。效率和部署都有极大的优势
我们将所有过程都视为静态，黄点的不同则代表了情况的不同，从而实现动态过程向静态过程的转化

图3-2 电梯系统布局示意图



图3-3 计算流程示意图1
图3-4 计算流程示意图2

6.9.2 评价指标的确定
平均运行时间(第一指标)→侯梯时间求和然后除以等待人数，乘客到达目的楼层之前都处于等待状态
平均乘梯时间(第二目标)
电梯的开关次数(第三目标，涉及效率和节能问题)
电梯能耗(第四指标)
电梯能耗消耗公式

6.9.3 仿真结果
算法名称	平均运行时间	平均乘梯时间	电梯开关次数	电梯能耗
DQN				
Q-learning				
Sarsa——lambda				
Sarsa				

实验讨论要点：
各公式的计算


第七章 结论
本文提出了一种基于深度强化学习的目的楼层预约调度算法，为让电梯调度算法在调度时间最短和算法适应性方面具备更好表现，在目前主流的电梯调度算法 基础之上，提出对调度环境和调度目标2个方面进行统一建模的基于强化学习DQN的电梯智能调度算法。让调度电梯在不断地和环境交互学习过程中逐渐学习得到最优电梯调度策略，与基于具体环境建模的相关电梯调度算法进行对比实验，基于DQN的调度算法具有建模简单规范、适应性强和控制目标多样的优势，对比 DQN算法与部分强化学习算法 在电梯调度中的优劣，实验结果表明，DQN算法具备较好的调度性能。 




























[1].Mnih V , Kavukcuoglu K , Silver D , et al. Playing Atari with Deep Reinforcement Learning[J]. Computer Science, 2013.
[2].Schulman J , Wolski F , Dhariwal P , et al. Proximal Policy Optimization Algorithms[J].  2017.
[3].Babaeizadeh M , Frosio I , Tyree S , et al. Reinforcement Learning through Asynchronous Advantage Actor-Critic on a GPU[J].  2016.
[4].Lillicrap TP , Hunt JJ , Pritzel A , et al. Continuous control with deep reinforcement learning[J]. Computer ence, 2015.
[5].Fujimoto S , Hoof HV, Meger D . Addressing Function Approximation Error in Actor-Critic Methods[J].  2018.
[6].Tsuji S ,  Amano M ,  Hikita S . Application of the expert system to elevator group-supervisory control[C]// Conference on Artificial Intelligence Applications. IEEE, 1989.
[7].Kaneko M ,  Ishikawa T ,  Sogawa Y . Supervisory control for elevator group by using fuzzy expert system[C]// Industrial Electronics, Control and Instrumentation, 1997. IECON 97. 23rd International Conference on. IEEE, 1997.
[8].Fujino A ,  Tobita T . An elevator group control system with floor-attribute control method and system optimization using genetic algorithms[J]. Industrial Electronics IEEE Transactions on, 1997, 44(4):546-552.
[9].郭方欣. 神经网络在电梯群控技术中的应用[D]. 哈尔滨工程大学.
[10].顾玲丽,董佳琦,许洪华. 基于强化蚁群算法的高层住宅电梯群调度研究[J]. 计算机仿真,2022,39(1):412-417. DOI:10.3969/j.issn.1006-9348.2022.01.086.
[11].王丽冰,马仕君,徐素洁,孙琳琳,韩康,胡欣. 基于深度强化学习的电梯智能调度系统[C]//.2020中国信息通信大会论文集（CICC 2020）.,2020:477-482.DOI:10.26914/c.cnkihy.2020.055875.
[12].刘宇,张聪,李涛.强化学习A3C算法在电梯调度中的建模及应用[J].计算机工程与设计,2022,43(01):196-202.DOI:10.16208/j.issn1000-7024.2022.01.026.
[13].Tanaka S ,  Uraguchi Y ,  Araki M . Dynamic optimization of the operation of single-car elevator systems with destination hall call registration: Part II. The solution algorithm[J]. European Journal of Operational Research, 2005, 167( 2):574-587.
[14].许玉格,罗飞,曹建忠. 目的层预约的模糊神经网络电梯群控策略[J]. 华南理工大学学报（自然科学版）,2007,35(1):13-18. DOI:10.3321/j.issn:1000-565X.2007.01.003. 
[15].许玉格,宋亚龄,罗飞,等. 基于目的层预约的改进型粒子群电梯群控调度策略[J]. 北京交通大学学报,2012,36(5):134-138. DOI:10.3969/j.issn.1673-0291.2012.05.024. 
[16].孙朋飞. 基于目的楼层预约呼梯的电梯模糊控制群控调度[J]. 中国电梯,2021,32(1):23-29.
[17].郎曼. 电梯群控系统的节能优化调度仿真研究[D].太原理工大学,2017.
[18].徐新仁,李淑兰,朱恩芳,刘海峰,郑萍,徐东辉.基于最短距离调度原则的电梯群控技术研究[J].上饶师范学院学报,2020,40(06):4-9.
[19].李晨. 电梯智能群控调度算法研究[D].江苏科技大学,2018.
[20].蔡云霄,张敏良.基于Matlab的早高峰电梯群控调度系统仿真研究[J].计算机测量与控制,2018,26(09):97-102.DOI:10.16526/j.cnki.11-4762/tp.2018.09.021.
[21].刘影,吴常坤,谈丽娟.基于模糊控制的电梯群控调度算法设计与研究[J].自动化与仪表,2020,35(07):35-40.DOI:10.19557/j.cnki.1001-9944.2020.07.008.
[22].钟臻怡,杨家荣.电梯层站指示器装配车间调度优化算法[J].上海电气技术,2020,13(04):1-4.
[23].孙朋飞. 电梯群控系统调度策略的优化研究[D].太原科技大学,2019.DOI:10.27721/d.cnki.gyzjc.2019.000206.
[24].徐秀萍,李成良.基于PLC的电梯群控调度系统设计及其交通模式仿真[J].微型电脑应用,2021,37(02):95-98.
